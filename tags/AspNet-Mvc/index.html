<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tag: AspNet Mvc | Code Playground</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Code Playground">
<meta property="og:url" content="http://blog.codeplayground.org/tags/AspNet-Mvc/index.html">
<meta property="og:site_name" content="Code Playground">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Code Playground">
  
    <link rel="alternative" href="/atom.xml" title="Code Playground" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-89020543-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Code Playground</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Learning something daily</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/" class="article-date">
  <time datetime="2016-12-19T11:01:53.000Z" itemprop="datePublished">Dec 19 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/">Building a basic REST AspNet Core Example: Hypermedia - Part 8</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you need to catch up on the previous posts then see <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="part 1">part 1</a> &amp; <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" title="2">2</a>, <a href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" title="3">3</a>, <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/" title="4">4</a>, <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/" title="5">5</a>, <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/" title="6">6</a>, <a href="/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/" title="7">7</a>. The source code for this post is at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/8_Invoice_Api" target="_blank" rel="external">github</a>.</p>
<p>First a disclaimer - this blog is a journey for me, I am no expert in hypermedia - rather a newbie trying it and documenting it here (hence the site name Code Playground). So whether or not I am all into hypermedia is to be determined.</p>
<h2 id="Hypermedia"><a href="#Hypermedia" class="headerlink" title="Hypermedia"></a>Hypermedia</h2><p>The third level of <a href="http://martinfowler.com/articles/richardsonMaturityModel.html" target="_blank" rel="external">Richardson’s maturity model</a> is about hypermedia. Oversimplified it is about also providing links in the response to actions you can take from the given state. HTML has hypermedia controls for this like the form, a, img tags. No-one really needs a manuel or documentation to use a web-site, and hypermedia can be seen as a way to make a protocol more self-documenting, make it less brittle to version changes etc.(if you provide all URI’s to the api then you can be locked in when attempting to change).</p>
<p>Notice Roy Fielding the man who coined REST is pretty strict on hypermedia saying you cannot call it REST without it. <a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven" target="_blank" rel="external">Read this post for more on that statement</a>. So no doubt the REST term is misused by many API’s in the wild.</p>
<p>With Json it is more unclear how hypermedia controls should be provided.  There is a range of options like</p>
<ul>
<li><a href="http://json-ld.org/" target="_blank" rel="external">Json-LD</a> (or look <a href="https://www.w3.org/TR/json-ld/" target="_blank" rel="external">here</a>)</li>
<li><a href="https://tools.ietf.org/html/draft-kelly-json-hal-08" target="_blank" rel="external">HAL</a> (notice the status is draft and V8 has just expired)</li>
<li><a href="http://jsonapi.org/" target="_blank" rel="external">JSON API</a></li>
<li><a href="http://amundsen.com/media-types/collection/" target="_blank" rel="external">Collection+Json</a></li>
<li><a href="https://github.com/kevinswiber/siren/blob/master/README.md" target="_blank" rel="external">Siren</a></li>
</ul>
<p>The “RESTFul Web APIs: Services for a Changing World” <a href="https://www.amazon.com/RESTful-Web-APIs-Services-Changing-ebook/dp/B00F5BS966" target="_blank" rel="external">book</a> looks at many of these and may be a read worth. You can also read this <a href="https://sookocheff.com/post/api/on-choosing-a-hypermedia-format/" target="_blank" rel="external">post by Kevin Sookocheff</a> that covers these formats. There is more material to this subject than I can cover - and I do not claim to be that familiar with each of the standards. In this post I will look at the first two.</p>
<h2 id="Json-LD-A-JSON-based-Serialization-for-Linked-Data"><a href="#Json-LD-A-JSON-based-Serialization-for-Linked-Data" class="headerlink" title="Json-LD - A JSON-based Serialization for Linked Data"></a>Json-LD - A JSON-based Serialization for Linked Data</h2><p>This is a W3C recommendation. It builds on the concept of Linked Data that says 1) Use URIs as names for things, 2) use HTTP URIs so that people can lookup the names 3) when someone looks up a URI provide useful information &amp; 4) include links to other URIs, so that people can discover more things.</p>
<p>You may read the Json-LD introduction to understand it further, but basically it provides eg. the ability to use links in your json and to describe the json document and its terms itself. It can be used on an existing API if you wish. There is a nice video <a href="https://www.youtube.com/watch?v=vioCbTo3C-4" target="_blank" rel="external">here</a> explaining the basics, and <a href="https://www.youtube.com/watch?v=UmvWk_TQ30A" target="_blank" rel="external">another one</a> that continues on the first. Expansion and Compaction is <a href="https://www.youtube.com/watch?v=Tm3fD89dqRE" target="_blank" rel="external">explained here</a> and is useful to watch to get the data exchange idea behind Json-LD.</p>
<p>Let’s look at how Json-LD can be used with our invoice representation. But first let’s look at the response for GET /invoices/1,</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  &quot;dueDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  &quot;customer&quot;: &#123;</div><div class="line">    &quot;name&quot;: &quot;Customer 1&quot;,</div><div class="line">    &quot;addressLines&quot;: []</div><div class="line">  &#125;,</div><div class="line">  &quot;subTotal&quot;: 20.0,</div><div class="line">  &quot;lines&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;lineNumber&quot;: 1,</div><div class="line">      &quot;description&quot;: &quot;Line 1&quot;,</div><div class="line">      &quot;quantity&quot;: 2.0,</div><div class="line">      &quot;itemPrice&quot;: 10.0,</div><div class="line">      &quot;total&quot;: 20.0</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;id&quot;: &quot;1&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now when using the property name invoiceDate what exactly do we mean. Json-LD aims high and goes for a common understanding between different web sites of what we mean, so it tries to solve the ambiguity of what that term means. To be specific the property could be specified as an URI (or URL if it can be dereferenced)</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;http://restexample.org/types/invoice#invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>in this case it states we mean an invoice date as defined by restexample.  And at the end of this url we provide documentation for this property. We could also have looked in schema.org and picked the URL from there - thus aiming to provide a more crosssite understanding the data, but even within our own company this may be useful. But to fit that understanding into your existing json structure we add a @context to the json. The context tells us how to understand the json data. It allows us to map between the property name (called terms) and the unique name (IRI), as shown here. </p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &#123;</div><div class="line">		&quot;invoiceDate&quot;: &quot;http://restexample.org/types/invoice#invoiceDate&quot;	</div><div class="line">		...</div><div class="line">	&#125;</div><div class="line">  invoiceDate: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The context does not have to go within your data as shown here. It can be pointed to using the Http Link header. You can also reference it like this<br><figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &quot;http://restexample.org/invoice.jsonld&quot;</div><div class="line">  	&quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  	...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>It also introduces the concept of global identifiers to identify the objects, that is to add links.</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &quot;http://restexample.org/invoice.jsonld&quot;</div><div class="line">  	&quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  	&quot;@id&quot;: &quot;http://restexample.org/invoice/1&quot;</div><div class="line">  	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>So eg. in the case of getting a list of invoices this can be useful with a link for each invoice. You can also specify the type of a property. Let’s say our invoice has a link to sales support</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &#123;</div><div class="line">		&quot;invoiceDate&quot;: &quot;http://restexample.org/types/invoice#invoiceDate&quot;,</div><div class="line">		&quot;salesSupport&quot;: &#123;</div><div class="line">			&quot;@id&quot;: &quot;http://restexample.org/types/invoice#salesSupport&quot;,</div><div class="line">			&quot;@type&quot;: &quot;@id&quot;</div><div class="line">		&#125;</div><div class="line">		...</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">  	&quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  	&quot;salesSupport&quot;: &quot;http://restexample.org/salesSupport&quot;</div><div class="line">  	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>with the above context we can specify the property salesSupport is to be treated like a link. @type can more generally be used to inform about its type like number, datetime etc. Like shown here.</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &#123;</div><div class="line">		&quot;invoiceDate&quot;: &#123;</div><div class="line">				&quot;@id&quot;: &quot;http://restexample.org/types/invoice#invoiceDate&quot;,</div><div class="line">				&quot;@type&quot;: &quot;https://schema.org/DateTime&quot;</div><div class="line">		&#125;,</div><div class="line">		&quot;dueDate&quot;: &#123;</div><div class="line">				&quot;@id&quot;: &quot;http://restexample.org/types/invoice#dueDate&quot;,</div><div class="line">				&quot;@type&quot;: &quot;https://schema.org/DateTime&quot;</div><div class="line">		&#125;,</div><div class="line">		&quot;subTotal&quot;: &#123;</div><div class="line">			&quot;@id&quot;: &quot;http://restexample.org/types/invoice#subTotal&quot;,</div><div class="line">			&quot;@type&quot;: &quot;https://schema.org/Number&quot;</div><div class="line">		&#125;,</div><div class="line">		...</div><div class="line">      &#125;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>There’s much more to Json-Ld than shown here, but these are the basics. You can’t specify the actions you can take given the response. For this you can combine Json-Ld with <a href="http://www.markus-lanthaler.com/hydra/" target="_blank" rel="external">Hydra</a>. There’s a video on hydra <a href="https://www.youtube.com/watch?v=tRTD2W4W8G4" target="_blank" rel="external">here</a>. Hydra calls these actions “operations”. So you could specify that a delete operation exists like this</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &quot;http://www.w3.org/ns/hydra/context.jsonld&quot;,</div><div class="line">	&quot;@id&quot;: &quot;http://restexample.org/invoice/1&quot;,</div><div class="line">	&quot;operation&quot;: [</div><div class="line">		&#123;</div><div class="line">			&quot;@type&quot;: &quot;DeleteResourceOperation&quot;,</div><div class="line">			&quot;method&quot;: &quot;DELETE&quot;</div><div class="line">		&#125;</div><div class="line">	],</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>That’s just a simple example - I won’t cover hydra here in detail.</p>
<h3 id="AspNet-Core"><a href="#AspNet-Core" class="headerlink" title="AspNet Core"></a>AspNet Core</h3><p>To be reasonable to add Json-LD to the API some tooling is required. If not then these definitions will just end up out of sync with the implementation. For Json-LD client side operation there is <a href="https://github.com/NuGet/json-ld.net/" target="_blank" rel="external">json-ld.net</a> supporting the <a href="https://www.w3.org/TR/json-ld-api/" target="_blank" rel="external">Json-LD 1.0 Processing Algoritms and API</a>. There is also this <a href="https://github.com/wikibus/JsonLD.Entities" target="_blank" rel="external">one</a> that is not .Net core. So based on a quick google tour there is not something that easily fits the purpose. Let me know if you have the solution.</p>
<h2 id="HAL-JSON-Hypertext-Application-Language"><a href="#HAL-JSON-Hypertext-Application-Language" class="headerlink" title="HAL - JSON Hypertext Application Language"></a>HAL - JSON Hypertext Application Language</h2><p>Taken from HAL’s specification:</p>
<blockquote>
<p>HAL is a generic media type with which Web APIs can be developed and exposed as series of links.  Clients of these APIs can select links by their link relation type and traverse them in order to progress through the application.</p>
</blockquote>
<p>Basically it adds two reserved properties _links and _embedded JSON. It’s media type is “application/hal+json”. _links is defined as</p>
<blockquote>
<p>It is an object whose property names are link relation types (as defined by [RFC5988]) and values are either a Link Object or an array of Link Objects.  The subject resource of these links is the Resource Object of which the containing “_links” object is a property. </p>
</blockquote>
<p>To get the understanding of link relation types you can read <a href="https://tools.ietf.org/html/rfc5988#section-4" target="_blank" rel="external">RFC 5988 section 4</a> that says,</p>
<blockquote>
<p>In the simplest case, a link relation type identifies the semantics of a link.  For example, a link with the relation type “copyright” indicates that the resource identified by the target IRI is a statement of the copyright terms applying to the current context IRI. Link relation types can also be used to indicate that the target resource has particular attributes, or exhibits particular behaviours; for example, a “service” link implies that the identified resource is part of a defined protocol (in this case, a service description). </p>
</blockquote>
<p>So let’s see the link relation type as a a property name in HAL:<br><figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"> ...  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>“self” is the link relation property. <a href="https://tools.ietf.org/html/rfc4287#section-4.2.7.2" target="_blank" rel="external">“self”</a> signifies that the URL in the value of href attribute identifies a resource equivalent to the containing element. IANA has a link relation registry <a href="https://www.iana.org/assignments/link-relations/link-relations.xml" target="_blank" rel="external">here</a>. So take a look at these before inventing your own. </p>
<p>_embedded is defined as</p>
<blockquote>
<p>It is an object whose property names are link relation types (as defined by [RFC5988]) and values are either a Resource Object or an array of Resource Objects. Embedded Resources MAY be a full, partial, or inconsistent version of the representation served from the target URI.</p>
</blockquote>
<p>The Linked object can have the following properties href, templated, type, deprecation, name, profile, title, hreflang. But let’s see a constructed example for GET /invoices/</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;next&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices?page=2&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  &quot;_embedded&quot;: &#123;</div><div class="line">    &quot;invoices&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/2&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">        &quot;dueDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">        &quot;customer&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;Customer 1&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;subTotal&quot;: 20.0,</div><div class="line">        &quot;id&quot;: &quot;2&quot;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/2&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;invoiceDate&quot;: &quot;2016-12-18T00:00:00+01:00&quot;,</div><div class="line">        &quot;dueDate&quot;: &quot;2016-12-18T00:00:00+01:00&quot;,</div><div class="line">        &quot;customer&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;Customer 2&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;subTotal&quot;: 130.0,</div><div class="line">        &quot;id&quot;: &quot;1&quot;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here we have a “next” link relation that takes us to be next subset of invoices. _embedded contains a partial representation of the invoice representation with a link to each invoice. </p>
<p>In the above example we are using link relation types registered with IANA. When you need to create your own then <a href="https://tools.ietf.org/html/rfc5988#section-4.2" target="_blank" rel="external">RFC 5988 defines “Extension Relations Types”</a> says</p>
<blockquote>
<p>Applications that don’t wish to register a relation type can use an extension relation type, which is a URI [RFC3986] that uniquely identifies the relation type.  Although the URI can point to a resource that contains a definition of the semantics of the relation type, clients SHOULD NOT automatically access that resource to avoid overburdening its server.</p>
</blockquote>
<p>So <a href="http://restexample.org/relationTypes/foo" target="_blank" rel="external">http://restexample.org/relationTypes/foo</a> could be our own relation type. HAL tells us to provide links - that can be dereferenced in a web browser - that provides documentation. And we can use the CURIE to shorten these links. Here’s an example</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/orders&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;curies&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;name&quot;: &quot;acme&quot;,</div><div class="line">        &quot;href&quot;: &quot;http://docs.acme.com/relations/&#123;rel&#125;&quot;,</div><div class="line">        &quot;templated&quot;: true</div><div class="line">      &#125;</div><div class="line">    ],</div><div class="line">    &quot;acme:widgets&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/widgets&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>so acme:widgets unfolds to <a href="http://docs.acme.com/relations/widgets" target="_blank" rel="external">http://docs.acme.com/relations/widgets</a>.</p>
<h3 id="AspNet-Core-1"><a href="#AspNet-Core-1" class="headerlink" title="AspNet Core"></a>AspNet Core</h3><p>We can find a list of libraries for HAL <a href="https://github.com/mikekelly/hal_specification/wiki/Libraries" target="_blank" rel="external">here</a>. Most seems out of date (at the time of writing this post) so the choice we have is <a href="https://github.com/visualeyes/halcyon" target="_blank" rel="external">Halcyon</a>. Basically it provides us with a way to return HAL without changing our existing model using an extension method on the controller.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> HAL(model, <span class="keyword">new</span> Link[] &#123;</div><div class="line">    <span class="keyword">new</span> Link(<span class="string">"self"</span>, <span class="string">"/api/foo/&#123;id&#125;"</span>),</div><div class="line">    <span class="keyword">new</span> Link(<span class="string">"foo:bar"</span>, <span class="string">"/api/foo/&#123;id&#125;/bar"</span>)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>So let’s try Halcyon out on the InvoiceController. First change is the GET /invoices/{id}</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetInvoice"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> invoice = invoiceRepository.Get(id);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (invoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> currentETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;invoice.Version&#125;</span>\""</span>);</div><div class="line">    <span class="keyword">if</span> (IfMatchGivenIfNoneMatch(currentETag))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode((<span class="keyword">int</span>)HttpStatusCode.NotModified);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = currentETag;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.HAL(getInvoiceMapper.ToModel(invoice),</div><div class="line">        <span class="keyword">new</span> Link(<span class="string">"self"</span>, Request.Path));</div><div class="line">&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>the HAL extension is supplied with our model, and the self link (it will add it by itself if not specified, but with a non-standard method property).</p>
<p>The response for /invoices/1 now looks like this:</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;InvoiceDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">  &quot;DueDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">  &quot;Customer&quot;: &#123;</div><div class="line">    &quot;Name&quot;: &quot;Customer 1&quot;,</div><div class="line">    &quot;AddressLines&quot;: []</div><div class="line">  &#125;,</div><div class="line">  &quot;SubTotal&quot;: 20.0,</div><div class="line">  &quot;Lines&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;LineNumber&quot;: 1,</div><div class="line">      &quot;Description&quot;: &quot;Line 1&quot;,</div><div class="line">      &quot;Quantity&quot;: 2.0,</div><div class="line">      &quot;ItemPrice&quot;: 10.0,</div><div class="line">      &quot;Total&quot;: 20.0</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;Id&quot;: &quot;1&quot;,</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices/1&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>so a _links section is added with a self reference. Next change is the GET /invoices/. Here we use the embedded extension method.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[HttpGet]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> preferHeader = Request.Headers.Prefer();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (SupportedRepresentations.Contains(preferHeader.Return))</div><div class="line">    &#123;</div><div class="line">        Response.Headers.Add(<span class="string">"Preference-Applied"</span>, <span class="string">"return="</span> + preferHeader.Return);</div><div class="line">        Response.Headers.Add(<span class="string">"Vary"</span>, VaryHeaderValue);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> invoices = invoiceRepository.GetAll();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (preferHeader.Return == ReturnMinimal)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.HAL&lt;<span class="keyword">object</span>, GetMinimalInvoice&gt;(<span class="literal">null</span>,</div><div class="line">            <span class="keyword">new</span> Link(<span class="string">"self"</span>, Request.Path),</div><div class="line">            <span class="string">"invoices"</span>,</div><div class="line">            invoices.Select(invoice =&gt; getMinimalInvoiceMapper.ToModel(invoice)),</div><div class="line">            <span class="keyword">new</span> Link(<span class="string">"self"</span>, <span class="string">"/invoices/&#123;Id&#125;"</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.HAL&lt;<span class="keyword">object</span>, GetInvoice&gt;(<span class="literal">null</span>,</div><div class="line">        <span class="keyword">new</span> Link(<span class="string">"self"</span>, Request.Path),</div><div class="line">        <span class="string">"invoices"</span>,</div><div class="line">        invoices.Select(invoice =&gt; getInvoiceMapper.ToModel(invoice)),</div><div class="line">        <span class="keyword">new</span> Link(<span class="string">"self"</span>, <span class="string">"/invoices/&#123;Id&#125;"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we don’t really have any specific data for the collection itself - which is the reason for using null for the model as the first parameter for the HAL method. Then comes the collection link followed by the name of the embedded collection. Next is the embedded collection with its link. The link is specified as a template, that takes the Id from the invoice. Here is the GET</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices/&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  &quot;_embedded&quot;: &#123;</div><div class="line">    &quot;invoices&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;InvoiceDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;DueDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;Customer&quot;: &#123;</div><div class="line">          &quot;Name&quot;: &quot;Customer 1&quot;,</div><div class="line">          &quot;AddressLines&quot;: []</div><div class="line">        &#125;,</div><div class="line">        &quot;SubTotal&quot;: 20.0,</div><div class="line">        &quot;Lines&quot;: [</div><div class="line">          &#123;</div><div class="line">            &quot;LineNumber&quot;: 1,</div><div class="line">            &quot;Description&quot;: &quot;Line 1&quot;,</div><div class="line">            &quot;Quantity&quot;: 2.0,</div><div class="line">            &quot;ItemPrice&quot;: 10.0,</div><div class="line">            &quot;Total&quot;: 20.0</div><div class="line">          &#125;</div><div class="line">        ],</div><div class="line">        &quot;Id&quot;: &quot;1&quot;,</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/1&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        &quot;InvoiceDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;DueDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;Customer&quot;: &#123;</div><div class="line">          &quot;Name&quot;: &quot;Customer 2&quot;,</div><div class="line">          &quot;AddressLines&quot;: []</div><div class="line">        &#125;,</div><div class="line">        &quot;SubTotal&quot;: 20.0,</div><div class="line">        &quot;Lines&quot;: [</div><div class="line">          &#123;</div><div class="line">            &quot;LineNumber&quot;: 1,</div><div class="line">            &quot;Description&quot;: &quot;Line 1&quot;,</div><div class="line">            &quot;Quantity&quot;: 2.0,</div><div class="line">            &quot;ItemPrice&quot;: 10.0,</div><div class="line">            &quot;Total&quot;: 20.0</div><div class="line">          &#125;</div><div class="line">        ],</div><div class="line">        &quot;Id&quot;: &quot;2&quot;,</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/2&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Providing paging would now be a question of providing a “prev”, “next” link.</p>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h2><p>Writing this post I realized that for a newbie to use hypermedia you have a rather large evaluation task to go though.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/" data-id="ciwvz30ds00042saakts0ejhr" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/" class="article-date">
  <time datetime="2016-12-16T13:12:43.000Z" itemprop="datePublished">Dec 16 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/">Building a basic REST AspNet Core Example: Caching - Part 7</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you need to catch up on the previous posts then see <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="part 1">part 1</a> &amp; <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" title="2">2</a>, <a href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" title="3">3</a>, <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/" title="4">4</a>, <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/" title="5">5</a>, <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/" title="6">6</a>. The source code for this post is at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/7_Invoice_Api" target="_blank" rel="external">github</a>.</p>
<p>This post will take a look at <a href="https://tools.ietf.org/html/rfc7234" target="_blank" rel="external">RFC 7234</a> which is about HTTP 1.1 caching. It is mainly about two headers Expires and Cache-Control. The first one is for server responses. The second one can be used both on requests and responses. Cache-Control has the highest precedence. If your API returns a GET (safe method) with a 200 response then it can be subject to caching. If you don’t specify anything in your GET response the cache may assign a heuristic expiration time. Other status codes where this can <a href="https://tools.ietf.org/html/rfc7231#section-6.1" target="_blank" rel="external">happen is</a></p>
<blockquote>
<p>Responses with status codes that are defined as cacheable by default (e.g., 200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501 in this specification) can be reused by a cache with heuristic expiration unless otherwise indicated by the method definition or explicit cache controls [RFC7234]; all other status codes are not cacheable by default.</p>
</blockquote>
<p>If you specify Last-Modified or ETag these are taken into account.</p>
<h2 id="Expires-Header"><a href="#Expires-Header" class="headerlink" title="Expires Header"></a>Expires Header</h2><p>You can read about the <a href="https://tools.ietf.org/html/rfc7234#section-5.3" target="_blank" rel="external">Expires header here</a>. Basically it allows you to specify a date after which the response is considered stale. Like this</p>
<p>Expires: Fri, 16 Dec 2016 16:00:00 GMT</p>
<h2 id="Cache-Control-Header"><a href="#Cache-Control-Header" class="headerlink" title="Cache-Control Header"></a>Cache-Control Header</h2><p>You can read about the <a href="https://tools.ietf.org/html/rfc7234#section-5.2" target="_blank" rel="external">Cache-Control header here</a>. The directives you can use depends on if we are talking about the request or the response. So let’s shortly look at some of these</p>
<h3 id="Request-Cache-Control-Directives"><a href="#Request-Cache-Control-Directives" class="headerlink" title="Request Cache-Control Directives"></a>Request Cache-Control Directives</h3><ul>
<li><p>no-cache - Specify this directive if the client is not willing to get a cached response.</p>
</li>
<li><p>max-age - Specifying Cache-Control: max-age=5, means that the client is willing to accept a response that is up to 5 seconds old.</p>
</li>
<li><p>max-stale - Here the client is willing to accept a stale result, eg Cache-Control: max-stale=5.</p>
</li>
<li><p>min-fresh - Here you say that you want a result that will be fresh for at least the time specified.</p>
</li>
<li><p>no-transform - Says no intermediary may transform the payload.</p>
</li>
<li><p>only-if-cached - Can be used to explicitly go for a cached response. If not in the cache you will get a 504 (Gateway timeout).</p>
</li>
</ul>
<h3 id="Response-Cache-Control-Directives"><a href="#Response-Cache-Control-Directives" class="headerlink" title="Response Cache-Control Directives"></a>Response Cache-Control Directives</h3><p>Some of the response directives are</p>
<ul>
<li><p>must-revalidate - Says that when the response is stale the cache must not use the response without successfull validation on the origin server. If it cannot reach the origin server it will return 504 (Gateway Timeout).</p>
</li>
<li><p>no-cache - Says that the response may not be stored without validating the subsequent requests.</p>
</li>
<li><p>no-store - Says that the response must not be stored in the cache.</p>
</li>
<li><p>public - Says that the response may be stored in either a shared or private (local) cache.</p>
</li>
<li><p>private - Says that the response may be stored in the user’s cache</p>
</li>
<li><p>max-age - Says that the response is stale after the specified number of seconds.</p>
</li>
<li><p>s-maxage - Says that the response is stale in a shared cache after the specified number of seconds.</p>
</li>
</ul>
<h2 id="Using-Caching"><a href="#Using-Caching" class="headerlink" title="Using Caching"></a>Using Caching</h2><p>You should use caching to provide scalability and decrease the load on your server. In the previous posts we made a FileController that can return files. This could potentially put a load on server we may want to minimize. You can read more about caching with aspnet core <a href="https://docs.microsoft.com/en-us/aspnet/core/performance/caching/response" target="_blank" rel="external">here</a>. Basically we just have to use the ResponseCacheAttribute. Let’s try it out with curl and Nginx (or whatever your preferred tool might be). Here I’ve put nginx in front of the aspnet core app running on port 5000. So when hitting 8080 nginx will be the cache intermediate.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">	proxy_cache_path /home/mikael/nginx-cache levels=1:2 keys_zone=my_cache:10m max_size=10g</div><div class="line">             inactive=60m use_temp_path=off;</div><div class="line"></div><div class="line">	server &#123;</div><div class="line">		listen	8080;</div><div class="line">		location / &#123;</div><div class="line">			proxy_cache my_cache;</div><div class="line">    		proxy_pass http://127.0.0.1:5000/;</div><div class="line">    		add_header X-Cache-Status $upstream_cache_status;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>Let’s try to get a file without any cache response header using </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">curl -I -X GET  http://localhost:8080/files/1</div><div class="line"></div><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.10.0 (Ubuntu)</div><div class="line">Date: Sat, 17 Dec 2016 15:18:11 GMT</div><div class="line">Content-Type: text/plain</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Connection: keep-alive</div><div class="line">Last-Modified: Sat, 10 Dec 2016 00:00:00 GMT</div><div class="line">X-Cache-Status: MISS</div><div class="line">```</div></pre></td></tr></table></figure>
<p>Notice the X-Cache-Status saying it is a cache MISS. Repeating the command will give the same result. In principle it could have stored it according to the RFC. Let’s try to add the attribute as shown here</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[Route(<span class="string">"files"</span>)]</div><div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">FilesController</span> : <span class="title">Controller</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IRepository&lt;File&gt; fileRepository;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FilesController</span>(<span class="params">IRepository&lt;File&gt; fileRepository</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.fileRepository = fileRepository;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetFile"</span>)]</div><div class="line">    [ResponseCache(Duration = <span class="number">60</span>)]</div><div class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">    &#123;</div></pre></td></tr></table></figure>
<p>We get the following response.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.10.0 (Ubuntu)</div><div class="line">Date: Sat, 17 Dec 2016 15:24:02 GMT</div><div class="line">Content-Type: text/plain</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Connection: keep-alive</div><div class="line">Cache-Control: public,max-age=60</div><div class="line">Last-Modified: Sat, 10 Dec 2016 00:00:00 GMT</div><div class="line">X-Cache-Status: MISS</div></pre></td></tr></table></figure>
<p>Saying that the response can be cached for 60 seconds in private + shared caches. Retrying it within the time limit and we get X-Cache-Status: HIT. After the 60 seconds we can see nginx makes a new request and returns X-Cache-Status: EXPIRED (make one more request and it will give a HIT).</p>
<p>Now let’s specify that only the client may cache the result.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetFile"</span>)]</div><div class="line">[ResponseCache(Duration = <span class="number">60</span>, Location=ResponseCacheLocation.Client)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div></pre></td></tr></table></figure>
<p>Now we will always get</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.10.0 (Ubuntu)</div><div class="line">Date: Sat, 17 Dec 2016 15:33:44 GMT</div><div class="line">Content-Type: text/plain</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Connection: keep-alive</div><div class="line">Cache-Control: private,max-age=60</div><div class="line">Last-Modified: Sat, 10 Dec 2016 00:00:00 GMT</div><div class="line">X-Cache-Status: EXPIRED</div></pre></td></tr></table></figure>
<p>or rather MISS as X-Cache-Status but the cache already has the entry from before. If we specify ResponseCacheLocation.None like below we must also specify the Duration</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetFile"</span>)]</div><div class="line">[ResponseCache(Location = ResponseCacheLocation.None, Duration = <span class="number">60</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.10.0 (Ubuntu)</div><div class="line">Date: Sat, 17 Dec 2016 15:42:59 GMT</div><div class="line">Content-Type: text/plain</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Connection: keep-alive</div><div class="line">Cache-Control: no-cache,max-age=60</div><div class="line">Pragma: no-cache</div><div class="line">Last-Modified: Sat, 10 Dec 2016 00:00:00 GMT</div><div class="line">X-Cache-Status: EXPIRED</div></pre></td></tr></table></figure>
<p>If we do not want the result cached at all we can do it like this</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetFile"</span>)]</div><div class="line">[ResponseCache(NoStore = <span class="literal">true</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div></pre></td></tr></table></figure>
<p>and then we get</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.10.0 (Ubuntu)</div><div class="line">Date: Sat, 17 Dec 2016 15:46:43 GMT</div><div class="line">Content-Type: text/plain</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Connection: keep-alive</div><div class="line">Cache-Control: no-store</div><div class="line">Last-Modified: Sat, 10 Dec 2016 00:00:00 GMT</div><div class="line">X-Cache-Status: EXPIRED</div></pre></td></tr></table></figure>
<p>The VARY header is also supported</p>
<p>[ResponseCache(Location = ResponseCacheLocation.Any, Duration = 60, VaryByHeader = “Accept-Encoding”)]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.10.0 (Ubuntu)</div><div class="line">Date: Sat, 17 Dec 2016 15:59:08 GMT</div><div class="line">Content-Type: text/plain</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Connection: keep-alive</div><div class="line">Cache-Control: public,max-age=60</div><div class="line">Last-Modified: Sat, 10 Dec 2016 00:00:00 GMT</div><div class="line">Vary: Accept-Encoding</div><div class="line">X-Cache-Status: HIT</div></pre></td></tr></table></figure>
<h2 id="Using-Cache-Profiles"><a href="#Using-Cache-Profiles" class="headerlink" title="Using Cache Profiles"></a>Using Cache Profiles</h2><p>You probably don’t want to duplicate this attribute settings on many controllers. So instead you can define a profile in ConfigureServices in Startup.cs like shown here</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></div><div class="line">&#123;</div><div class="line">	services.AddMvc(options =&gt;</div><div class="line">	&#123;</div><div class="line">	    options.CacheProfiles.Add(<span class="string">"Default"</span>, <span class="keyword">new</span> CacheProfile()</div><div class="line">	    &#123;</div><div class="line">	        Duration = <span class="number">60</span>,</div><div class="line">	        Location = ResponseCacheLocation.Client</div><div class="line">	    &#125;);</div><div class="line">	    LimitFormattersToThisApplication(options);</div><div class="line">	&#125;);</div><div class="line">...</div></pre></td></tr></table></figure>
<p>in the FilesController we can then change the attribute to</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetFile"</span>)]</div><div class="line">[ResponseCache(CacheProfileName =  <span class="string">"Default"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div></pre></td></tr></table></figure>
<h2 id="If-you-don’t-want-attributes-or-profiles"><a href="#If-you-don’t-want-attributes-or-profiles" class="headerlink" title="If you don’t want attributes or profiles"></a>If you don’t want attributes or profiles</h2><p>In this case then you can do everything using the ResponseHeaders, it has a CacheControl property and Expires.</p>
<h2 id="Without-an-External-Server"><a href="#Without-an-External-Server" class="headerlink" title="Without an External Server"></a>Without an External Server</h2><p>If you do not want to use an external server like nginx then AspNet <a href="https://github.com/aspnet/ResponseCaching" target="_blank" rel="external">itself has response caching middelware</a>. The default you get is a memory cache. This may work for you depending on your use case.</p>
<p>To enable it you basically have to add the following to your Startup.cs file</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></div><div class="line">&#123;</div><div class="line">    services.AddResponseCaching();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app</span>)</span></div><div class="line">&#123;</div><div class="line">    app.UseResponseCaching();</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Running the basic sample in the AspNet github repository and making two requests,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Sat, 17 Dec 2016 16:16:32 GMT</div><div class="line">Server: Kestrel</div><div class="line">Cache-Control: public, max-age=10</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Vary: Accept-Encoding</div><div class="line">Vary: Non-Existent</div><div class="line"></div><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Sat, 17 Dec 2016 16:16:32 GMT</div><div class="line">Content-Length: 32</div><div class="line">Server: Kestrel</div><div class="line">Cache-Control: public, max-age=10</div><div class="line">Age: 5</div><div class="line">Vary: Accept-Encoding</div><div class="line">Vary: Non-Existent</div><div class="line"></div></pre></td></tr></table></figure>
<p>It’s the Age header that tell us we got caching in place.</p>
<h1 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h1><p>That’s all I wanted to mention about caching. I will continue this REST example in future posts.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/" data-id="ciwvz30dj00002saakltsaeif" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Building-a-basic-REST-AspNet-Core-Example-Part-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/" class="article-date">
  <time datetime="2016-12-15T15:00:19.000Z" itemprop="datePublished">Dec 15 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/">Building a basic REST AspNet Core Example - Part 6</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you need to catch up on the previous posts then see <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="part 1">part 1</a> &amp; <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" title="2">2</a>, <a href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" title="3">3</a>, <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/" title="4">4</a>, <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/" title="5">5</a>. The source code for this post is at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/6_Invoice_Api" target="_blank" rel="external">github</a>.</p>
<p>In this post I will look at additional HTTP features. That is HTTP status 202 Accepted and the Retry-After header and see how this can be used with our FileController created in the last <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/" title="post">post</a>.</p>
<h2 id="HTTP-Status-202-Accepted"><a href="#HTTP-Status-202-Accepted" class="headerlink" title="HTTP Status 202 Accepted"></a>HTTP Status 202 Accepted</h2><p>You can read about 202 Accepted in <a href="https://tools.ietf.org/html/rfc7231#section-6.3.3" target="_blank" rel="external">in RFC 7231 section 6.3.3</a>.</p>
<blockquote>
<p>The 202 (Accepted) status code indicates that the request has been accepted for processing, but the processing has not been completed. The request might or might not eventually be acted upon, as it might be disallowed when processing actually takes place.</p>
</blockquote>
<p>This status code fits well with adding a new file using POST. We could perform a virus scan or do other custom processing before it becomes available. At the time of writing this post AcceptedAtRoute response is only added to the DEV branch of AspNet at GitHub. So we will do a hack adding it to our solution. Likewise IFormCollection is in a newer version than shown here. So here’s the implementation.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[HttpPost]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Post</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> file = Request.Form.Files.FirstOrDefault();</div><div class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    File newFile;</div><div class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> stream = <span class="keyword">new</span> MemoryStream())</div><div class="line">    &#123;</div><div class="line">        file.CopyTo(stream);</div><div class="line">        newFile = <span class="keyword">new</span> File(stream.ToArray(), DateTimeOffset.Now, file.ContentType);</div><div class="line">        fileRepository.Create(newFile);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> AcceptedAtRouteResult(<span class="string">"GetFile"</span>, <span class="keyword">new</span> &#123; id = newFile.Id&#125;, <span class="literal">null</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You should imagine that fileRepository.Create spins off eg. a virus check.</p>
<h2 id="Retry-After-Header"><a href="#Retry-After-Header" class="headerlink" title="Retry-After Header"></a>Retry-After Header</h2><p>You can read about the Retry-After header <a href="https://tools.ietf.org/html/rfc7231#section-7.1.3" target="_blank" rel="external">in RFC 7231 section 7.1.3</a></p>
<blockquote>
<p>Servers send the “Retry-After” header field to indicate how long the user agent ought to wait before making a follow-up request.  When sent with a 503 (Service Unavailable) response, Retry-After indicates how long the service is expected to be unavailable to the client.</p>
</blockquote>
<p>Here we are going to use Retry-After in another way. That is with the GET request that we pointed to with the AcceptedAtRouteResult. I can imagine this behaviour is debateable, so don’t go do it without considering the consequences. But in this case when then file isn’t available yet we will return No Content status along with the Retry-After header.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> file = fileRepository.Get(id);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> requestHeaders = Request.GetTypedHeaders();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (requestHeaders.IfNoneMatch == <span class="literal">null</span> &amp;&amp;</div><div class="line">        requestHeaders.IfModifiedSince.HasValue</div><div class="line">        &amp;&amp; requestHeaders.IfModifiedSince.Value &gt;= file.LastModified)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode(StatusCodes.Status304NotModified);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!file.IsAvailable)</div><div class="line">    &#123;</div><div class="line">        Response.Headers.Add(HeaderNames.RetryAfter, <span class="string">"60"</span>);</div><div class="line">        <span class="keyword">return</span> NoContent();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.LastModified = file.LastModified;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> File(file.Content, file.ContentType);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>I have introduced a property IsAvailable on the File class to determine if a No Content along with a Retry-After header should be returned. Now when we make the request to a newly upload file we get:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 204 No Content</div><div class="line">Date: Fri, 16 Dec 2016 10:08:26 GMT</div><div class="line">Retry-After: 60</div><div class="line">Server: Kestrel</div></pre></td></tr></table></figure>
<p>that says we should retry after 60 seconds.</p>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h2><p>That’s it for now. But the REST story will continue in other posts.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/" data-id="ciwvz30dq00032saah4xd9v0k" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Building-a-basic-REST-AspNet-Core-Example-Part-5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/" class="article-date">
  <time datetime="2016-12-15T09:31:41.000Z" itemprop="datePublished">Dec 15 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/">Building a basic REST AspNet Core Example - Part 5</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you need to catch up on the previous posts then see <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="part 1">part 1</a> &amp; <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" title="2">2</a>, <a href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" title="3">3</a>, <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/" title="4">4</a>. The source code for this post is at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/5_Invoice_Api" target="_blank" rel="external">github</a>.</p>
<p>In this post I will look at additional HTTP features. We will revisit the case of when a resource was modified. We looked at ETag previously. In this post we will tackle the case where we want to go with a date for comparison instead. This should be done if generation of an ETag does not make sense for you.</p>
<h2 id="Last-Modified-If-Modified-Since-If-Unmodified-Since"><a href="#Last-Modified-If-Modified-Since-If-Unmodified-Since" class="headerlink" title="Last-Modified, If-Modified-Since, If-Unmodified-Since"></a>Last-Modified, If-Modified-Since, If-Unmodified-Since</h2><p>When we looked at ETag in the InvoiceController we did not provide a Last-Modified response header. In the case of an invoice we would probably in real life also keep track of modification and thus we should provide this header according to <a href="https://tools.ietf.org/html/rfc7232#section-2.4" target="_blank" rel="external">RFC 7232</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">200 (OK) responses to GET or HEAD, an origin server:</div><div class="line"></div><div class="line">   o  SHOULD send an entity-tag validator unless it is not feasible to</div><div class="line">      generate one.</div><div class="line">... </div><div class="line">   o  SHOULD send a Last-Modified value if it is feasible to send one.</div></pre></td></tr></table></figure>
<p>Here we will look at a limited FilesController where files can be uploaded, and retrieved. I will just make enough code to highlight the HTTP features. We will add a simplified File class to the domain</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">File</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">File</span>(<span class="params"><span class="keyword">byte</span>[] content, DateTimeOffset lastModified, <span class="keyword">string</span> contentType</span>)</span></div><div class="line">    &#123;</div><div class="line">        Content = content;</div><div class="line">        LastModified = lastModified;</div><div class="line">        ContentType = contentType;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] Content &#123; <span class="keyword">get</span>; &#125;</div><div class="line">    <span class="keyword">public</span> DateTimeOffset LastModified &#123; <span class="keyword">get</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> ContentType &#123; <span class="keyword">get</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>and provide a FileRepository for it (not shown here). Now we could make a simple GET implementation like this that return the LastModified header</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[Route(<span class="string">"files"</span>)]</div><div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">FilesController</span> : <span class="title">Controller</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IRepository&lt;File&gt; fileRepository;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FilesController</span>(<span class="params">IRepository&lt;File&gt; fileRepository</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.fileRepository = fileRepository;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [HttpGet(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> file = fileRepository.Get(id);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (file == <span class="literal">null</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> NotFound();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">        responseHeaders.LastModified = file.LastModified;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> File(file.Content, file.ContentType);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Let’s extend this to handle If-Modified-Since.</p>
<h2 id="If-Modified-Since"><a href="#If-Modified-Since" class="headerlink" title="If-Modified-Since"></a>If-Modified-Since</h2><p>We have to live up to the following in <a href="https://tools.ietf.org/html/rfc7232#section-3.3" target="_blank" rel="external">RFC 7232 section 3.3</a>:</p>
<blockquote>
<p>A recipient MUST ignore If-Modified-Since if the request contains an If-None-Match header field;<br>A recipient MUST ignore the If-Modified-Since header field if the received field-value is not a valid HTTP-date, or if the request method is neither GET nor HEAD.</p>
</blockquote>
<p>This can be fullfilled by this implementation<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> file = fileRepository.Get(id);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> requestHeaders = Request.GetTypedHeaders();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (requestHeaders.IfNoneMatch == <span class="literal">null</span> &amp;&amp;</div><div class="line">        requestHeaders.IfModifiedSince.HasValue</div><div class="line">        &amp;&amp; requestHeaders.IfModifiedSince.Value &gt;= file.LastModified)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode(StatusCodes.Status304NotModified);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.LastModified = file.LastModified;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> File(file.Content, file.ContentType);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="If-Unmodified-Since"><a href="#If-Unmodified-Since" class="headerlink" title="If-Unmodified-Since"></a>If-Unmodified-Since</h2><p>You can find the description for the If-Modified-Since header in <a href="https://tools.ietf.org/html/rfc7232#section-3.4" target="_blank" rel="external">RFC 7232 section 3.4</a>. The use case is as the standard says:</p>
<blockquote>
<p>If-Unmodified-Since is most often used with state-changing methods (e.g., POST, PUT, DELETE) to prevent accidental overwrites when multiple user agents might be acting in parallel on a resource that does not supply entity-tags with its representations</p>
</blockquote>
<p>Our example will be the DELETE method.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[HttpDelete(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Delete</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (!fileRepository.Exists(id))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Yeah this you would never do in real life</span></div><div class="line">    <span class="keyword">var</span> file = fileRepository.Get(id);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> requestHeaders = Request.GetTypedHeaders();</div><div class="line">    <span class="keyword">if</span> (requestHeaders.IfMatch != <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (!requestHeaders.IfMatch.All(match =&gt; match.Equals(EntityTagHeaderValue.Any)))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> StatusCode(StatusCodes.Status412PreconditionFailed);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (requestHeaders.IfUnmodifiedSince.HasValue</div><div class="line">            &amp;&amp; requestHeaders.IfUnmodifiedSince.Value &lt; file.LastModified)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> StatusCode(StatusCodes.Status412PreconditionFailed);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    fileRepository.Delete(id);</div><div class="line">    <span class="keyword">return</span> NoContent();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h2><p>So we have now seen how Last-Modified, If-Modified-Since, If-Unmodified-Since headers can work. Next up is more HTTP features.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/" data-id="ciwvz30e3000d2saachfmq5yd" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Building-a-basic-REST-AspNet-Core-Example-Part-4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/" class="article-date">
  <time datetime="2016-12-14T08:48:22.000Z" itemprop="datePublished">Dec 14 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/">Building a basic REST AspNet Core Example - Part 4</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you need to catch up on the previous posts then see <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="part 1">part 1</a> &amp; <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" title="2">2</a>, <a href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" title="3">3</a>. The source code for this post is at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/4_Invoice_Api" target="_blank" rel="external">github</a>.</p>
<p>Here we are going to take a look at how to tackle the GET /invoices call. I’ll repeat the disclamer - It is going to be pretty naive and basic and I will build on it in further posts (hopefully). We are still at level 2 in <a href="http://martinfowler.com/articles/richardsonMaturityModel.html" target="_blank" rel="external">Richardson’s maturity model</a> and will not take hypermedia in just yet. We will not even reach a full GET implementation in this post.</p>
<h2 id="GET-invoices-with-HTTP-Prefer-Header"><a href="#GET-invoices-with-HTTP-Prefer-Header" class="headerlink" title="GET invoices/ with HTTP Prefer Header"></a>GET invoices/ with HTTP Prefer Header</h2><p>One of the first things that we will have to think about is what resource representation we want. Now we could say we want to return the complete invoices, or we could say we do not want to return lines. Let’s start with the simplest case. We return a list with the full representation.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[HttpGet]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> invoices = invoiceRepository.GetAll().Select(</div><div class="line">        invoice =&gt; getInvoiceMapper.ToModel(invoice));</div><div class="line"></div><div class="line">    <span class="keyword">return</span> Ok(invoices);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>but in many cases that may not be what our client is interested in. We could probably cut the invoice lines. There are many ways in “the wild”, but here we are going to look at the <a href="https://tools.ietf.org/html/rfc7240" target="_blank" rel="external">HTTP Prefer Header in RFC 7240</a> as a way to tell the server how we prefer the response. To shortly introduce Prefer, the RFC says:</p>
<blockquote>
<p>The Prefer request header field is used to indicate that particular server behaviors are preferred by the client but are not required for successful completion of the request.  Prefer is similar in nature to the Expect header field defined by Section 6.1.2 of [RFC7231] with the exception that servers are allowed to ignore stated preferences.</p>
</blockquote>
<p>Section 4.2 specifies </p>
<blockquote>
<p>The “return=representation” preference indicates that the client prefers that the server include an entity representing the current state of the resource in the response to a successful request.</p>
<p>The “return=minimal” preference, on the other hand, indicates that the client wishes the server to return only a minimal response to a successful request</p>
</blockquote>
<p>which is just what we need here. So we want to be able to handle the following requests:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">GET /invoices HTTP/1.1</div><div class="line">Prefer: return=representation</div><div class="line"></div><div class="line">GET /invoices HTTP/1.1</div><div class="line">Prefer: return=minimal</div></pre></td></tr></table></figure>
<p>and the response should state which prefer’s we have handled</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Preference-Applied: return=representation</div></pre></td></tr></table></figure>
<p>You can also take a look at the parameters that IANA keeps a list of <a href="http://www.iana.org/assignments/http-parameters/http-parameters.xhtml" target="_blank" rel="external">here</a>. But actually we are also required to return the <a href="https://tools.ietf.org/html/rfc7231#section-7.1.4" target="_blank" rel="external">Vary Header</a> so that we do not mess up the HTTP infrastructure like shown here</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Wed, 14 Dec 2016 12:08:04 GMT</div><div class="line">Content-Type: application/vnd.restexample.finance+json; charset=utf-8</div><div class="line">Vary: Prefer,Accept,Accept-Encoding</div><div class="line">Preference-Applied: return=representation</div></pre></td></tr></table></figure>
<p>Here’s the implementation<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[HttpGet]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> preferHeader = Request.Headers.Prefer();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (SupportedRepresentations.Contains(preferHeader.Return))</div><div class="line">    &#123;</div><div class="line">        Response.Headers.Add(<span class="string">"Preference-Applied"</span>, <span class="string">"return="</span> + preferHeader.Return);</div><div class="line">        Response.Headers.Add(<span class="string">"Vary"</span>, VaryHeaderValue);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> invoices = invoiceRepository.GetAll();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (preferHeader.Return == ReturnMinimal)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> Ok(invoices.Select(invoice =&gt; getMinimalInvoiceMapper.ToModel(invoice)));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> Ok(invoices.Select(invoice =&gt; getInvoiceMapper.ToModel(invoice)));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>We use a helper method to get the prefer header. If the representation asked for can be fullfilled then we return the required headers. If representation=minimal is specified then we return a list of invoices that has a minimal model as specified here</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GetMinimalInvoice</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> DateTimeOffset InvoiceDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> DateTimeOffset DueDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> GetInvoiceCustomer Customer &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">decimal</span> SubTotal &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h2><p>That concludes the first view on the GET invoices/.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/" data-id="ciwvz30dn00012saaixc1ect4" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Building-a-basic-REST-aspnet-core-example-Part-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" class="article-date">
  <time datetime="2016-12-12T12:04:13.000Z" itemprop="datePublished">Dec 12 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/">Building a basic REST AspNet Core Example - Part 3 </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In the previous <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="part 1">part 1</a> &amp; <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" title="2">2</a> we build an invoices controller with support for POST/PUT/GET/PATCH http methods. In this one we will add HTTP HEAD method and ETag support  - I’ll repeat the disclamer - It is going to be pretty naive and basic, but I will add to it in future posts (hopefully). The source code for this post is at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/3_Invoice_Api" target="_blank" rel="external">github</a>.</p>
<h2 id="Adding-HTTP-HEAD-support"><a href="#Adding-HTTP-HEAD-support" class="headerlink" title="Adding HTTP HEAD support"></a>Adding HTTP HEAD support</h2><p>You can read about the HEAD verb in the <a href="https://tools.ietf.org/html/rfc7231#section-4.3.2" target="_blank" rel="external">HTTP protocol</a>. But the part we are interested in is</p>
<blockquote>
<p>The HEAD method is identical to GET except that the server MUST NOT send a message body in the response (i.e., the response terminates at the end of the header section).  The server SHOULD send the same header fields in response to a HEAD request as it would have sent if the request had been a GET, except that the payload header fields MAY be omitted</p>
</blockquote>
<p>The verb is useful for existence checking, validation that you have the latest version etc. Here we will use it for existance checking to start with. We will omit the Content-Length header since it is allowed to do so, and our use case does not rely on it.</p>
<p>So let’s add a minimum implementation to the InvoicesController</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[HttpHead(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">HeadForInvoice</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    Response.ContentType = ApiDefinition.ApiMediaType;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!invoiceRepository.Exists(id))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> Ok();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We’d still like to return the Content-Type so thus we set it on the response. </p>
<p>The solution is still only at <a href="http://martinfowler.com/articles/richardsonMaturityModel.html" target="_blank" rel="external">richardson’s maturity model</a> level 2. And we can do better in multiple areas.</p>
<h2 id="ETag-If-match-If-none-match"><a href="#ETag-If-match-If-none-match" class="headerlink" title="ETag, If-match, If-none-match"></a>ETag, If-match, If-none-match</h2><p>Until now we have not really cared if our PUT call tries to update something even though it may have a stale view of the resource. The <a href="https://tools.ietf.org/html/rfc7232#section-2.3" target="_blank" rel="external">ETag header</a> can help us here. We can specify the current entity version on GET response with an ETag header. When we do a PUT we can then specify the “If-match” header with the ETag. Thus we will only update the resource if the ETag matches. But to use the ETag we would want to use it on most Http verbs. The example below uses the invoice version as the ETag - in principle this should have been an “opaque” value instead.</p>
<h3 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h3><p>We should return an ETag in the response when a GET request is made. It could be done like this (somewhat clumpsy)</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetInvoice"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> invoice = invoiceRepository.Get(id);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (invoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;invoice.Version&#125;</span>\""</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> Ok(getInvoiceMapper.ToModel(invoice));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Please note the invoice has been extended with a Version property that is changed when the update method of the repository is called.</p>
<p>So now when we make a request the response headers can look like this</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</div><div class="line">Date: Mon, <span class="number">12</span> Dec <span class="number">2016</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">21</span> GMT</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Content-Type: application/vnd.restexample.finance+json; charset=utf<span class="number">-8</span></div><div class="line">ETag: <span class="string">"e90baf01-40ce-4f46-89ea-227bb32fc421"</span></div><div class="line">Server: Kestrel</div></pre></td></tr></table></figure>
<p>We should also be able to handle the ETag if specified in the request. It will make sense to implement support for If-none-match header. We will return a new entity if the ETag does not match the current version of the invoice. If it matches we will return HTTP Not Modified.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetInvoice"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> invoice = invoiceRepository.Get(id);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (invoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> currentETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;invoice.Version&#125;</span>\""</span>);</div><div class="line">    <span class="keyword">if</span> (IfMatchGivenIfNoneMatch(currentETag))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode((<span class="keyword">int</span>)HttpStatusCode.NotModified);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = currentETag;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> Ok(getInvoiceMapper.ToModel(invoice));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">IfMatchGivenIfNoneMatch</span>(<span class="params">EntityTagHeaderValue currentETag</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> requestHeaders = Request.GetTypedHeaders();</div><div class="line">    <span class="keyword">return</span> requestHeaders.IfNoneMatch != <span class="literal">null</span> &amp;&amp;</div><div class="line">           requestHeaders.IfNoneMatch.Contains(currentETag);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>So now we can add the If-None-Match header to our request like this</p>
<p>If-None-Match: “e90baf01-40ce-4f46-89ea-227bb32fc421”</p>
<p>and if it is current we get these response headers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 304 Not Modified</div><div class="line">Date: Mon, 12 Dec 2016 17:28:02 GMT</div><div class="line">Server: Kestrel</div></pre></td></tr></table></figure>
<h3 id="PUT-PATCH"><a href="#PUT-PATCH" class="headerlink" title="PUT/PATCH"></a>PUT/PATCH</h3><p>Here we are going to return HTTP status Precondition Failed (415) if an ETag is provided and it does not match. The request should have the If-Match header added to it. Here is PUT</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">[HttpPut(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Put</span>(<span class="params"><span class="keyword">string</span> id, [FromBody] UpdateInvoice updateInvoice</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (updateInvoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!ModelState.IsValid)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest(ModelState);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!invoiceRepository.Exists(id))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (IfMatchIsInvalid(invoiceRepository.GetCurrentVersion(id)))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode((<span class="keyword">int</span>) HttpStatusCode.PreconditionFailed);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> newVersion = invoiceRepository.Update(updateInvoiceMapper.ToDomain(</div><div class="line">        updateInvoice, id)).Value;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;newVersion&#125;</span>\""</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> NoContent();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">IfMatchIsInvalid</span>(<span class="params"><span class="keyword">string</span> currentVersion</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> requestHeaders = Request.GetTypedHeaders();</div><div class="line">    <span class="keyword">var</span> currentETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;currentVersion&#125;</span>\""</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> requestHeaders.IfMatch != <span class="literal">null</span> &amp;&amp;</div><div class="line">           !requestHeaders.IfMatch.Any(ifm =&gt; ifm.Equals(EntityTagHeaderValue.Any))</div><div class="line">           &amp;&amp; !requestHeaders.IfMatch.Contains(currentETag);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The ETag can be specified as * thus we also check against EntityTagHeaderValue.Any.</p>
<p>We do the same for PATCH</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">[HttpPatch(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Patch</span>(<span class="params"><span class="keyword">string</span> id, [FromBody] JsonPatchDocument&lt;UpdateInvoice&gt; patchDocument</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (patchDocument == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> invoice = invoiceRepository.Get(id);</div><div class="line">    <span class="keyword">if</span> (invoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (IfMatchIsInvalid(invoice.Version))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode((<span class="keyword">int</span>) HttpStatusCode.PreconditionFailed);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> updateInvoice = updateInvoiceMapper.ToModel(invoice);</div><div class="line">    patchDocument.ApplyTo(updateInvoice, ModelState);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!ModelState.IsValid)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest(ModelState);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> updatedDomainInvoice = updateInvoiceMapper.ToDomain(updateInvoice, id);</div><div class="line">    <span class="keyword">var</span> newVersion = invoiceRepository.Update(updatedDomainInvoice);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;newVersion&#125;</span>\""</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> NoContent();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h3><p>HEAD should behave like GET so we can take that logic<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[HttpHead(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">HeadForInvoice</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    Response.ContentType = ApiDefinition.ApiMediaType;</div><div class="line">    Response.GetTypedHeaders();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!invoiceRepository.Exists(id))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> currentVersion = invoiceRepository.GetCurrentVersion(id);</div><div class="line">    <span class="keyword">var</span> currentETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;currentVersion&#125;</span>\""</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (IfMatchGivenIfNoneMatch(currentETag))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode((<span class="keyword">int</span>)HttpStatusCode.NotModified);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = currentETag;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> Ok();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><p>POST should return an ETag</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[HttpPost]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Post</span>(<span class="params">[FromBody] UpdateInvoice updateInvoice</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (updateInvoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!ModelState.IsValid)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest(ModelState);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> createdInvoice = invoiceRepository.Create(updateInvoiceMapper.ToDomain(updateInvoice));</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;createdInvoice.Version&#125;</span>\""</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> CreatedAtRoute(<span class="string">"GetInvoice"</span>,</div><div class="line">        <span class="keyword">new</span> &#123; id = createdInvoice.Id &#125;,</div><div class="line">        getInvoiceMapper.ToModel(createdInvoice));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h2><p>That is it for the most basic api for now. But we can do more as we will see in later posts (hopefully).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" data-id="ciwvz30dw00072saauru5408g" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Building-a-basic-REST-aspnet-core-example-Part-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" class="article-date">
  <time datetime="2016-12-09T09:18:40.000Z" itemprop="datePublished">Dec 9 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/">Building a basic REST AspNet Core Example - Part 2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In the last <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="post">post</a> we made the first step at a REST Api. In this post we will improve it by adding HTTP PATCH/OPTIONS support. I’ll repeat the disclamer - It is going to be pretty naive and basic, but I will add to it in future posts (hopefully). The source code for this post is <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/2_Invoice_Api" target="_blank" rel="external">here</a>.</p>
<h2 id="Adding-HTTP-PATCH-support"><a href="#Adding-HTTP-PATCH-support" class="headerlink" title="Adding HTTP PATCH support"></a>Adding HTTP PATCH support</h2><p>With PUT we have to supply the complete invoice in order to update it. That may not be what you want, so <a href="https://tools.ietf.org/html/rfc5789" target="_blank" rel="external">HTTP PATCH (rfc5789)</a> can help us here by allowing partial resource modification.</p>
<blockquote>
<p>The PATCH method requests that a set of changes described in the<br>request entity be applied to the resource identified by the Request-<br>URI.  The set of changes is represented in a format called a “patch<br>document” identified by a media type</p>
</blockquote>
<p>For JSON in .NET core this is implemented using <a href="https://tools.ietf.org/html/rfc6902" target="_blank" rel="external">JavaScript Object Notation (JSON) Patch</a>. The media type is “application/json-patch+json”. From Json Patch you can read</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">A JSON Patch document is a JSON [RFC4627] document that represents an</div><div class="line">array of objects.  Each object represents a single operation to be</div><div class="line">applied to the target JSON document.</div><div class="line"></div><div class="line">The following is an example JSON Patch document, transferred in a HTTP PATCH request:</div><div class="line"></div><div class="line">PATCH /my/data HTTP/1.1</div><div class="line">Host: example.org</div><div class="line">Content-Length: 326</div><div class="line">Content-Type: application/json-patch+json</div><div class="line">If-Match: &quot;abc123&quot;</div><div class="line"></div><div class="line">[</div><div class="line"> &#123; &quot;op&quot;: &quot;test&quot;, &quot;path&quot;: &quot;/a/b/c&quot;, &quot;value&quot;: &quot;foo&quot; &#125;,</div><div class="line"> &#123; &quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/a/b/c&quot; &#125;,</div><div class="line"> &#123; &quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/a/b/c&quot;, &quot;value&quot;: [ &quot;foo&quot;, &quot;bar&quot; ] &#125;,</div><div class="line"> &#123; &quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/a/b/c&quot;, &quot;value&quot;: 42 &#125;,</div><div class="line"> &#123; &quot;op&quot;: &quot;move&quot;, &quot;from&quot;: &quot;/a/b/c&quot;, &quot;path&quot;: &quot;/a/b/d&quot; &#125;,</div><div class="line"> &#123; &quot;op&quot;: &quot;copy&quot;, &quot;from&quot;: &quot;/a/b/d&quot;, &quot;path&quot;: &quot;/a/b/e&quot; &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>So { “op”: “replace”, “path”: “/a/b/c”, “value”: 42 } tells us that the operation should replace the target value with 42. The path is a <a href="https://tools.ietf.org/html/rfc6901" target="_blank" rel="external">JSON Pointer</a>. If you want to take a look at the aspnet source code then look <a href="https://github.com/aspnet/JsonPatch" target="_blank" rel="external">here</a>. From the unit test you can also see that the “test” operation is not supported.</p>
<p>So let us extend our InvoicesController</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[HttpPatch(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Patch</span>(<span class="params"><span class="keyword">string</span> id, [FromBody] JsonPatchDocument&lt;UpdateInvoice&gt; patchDocument</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (patchDocument == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> invoice = invoiceRepository.Get(id);</div><div class="line">    <span class="keyword">if</span> (invoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> updateInvoice = updateInvoiceMapper.ToModel(invoice);</div><div class="line">    patchDocument.ApplyTo(updateInvoice, ModelState);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!ModelState.IsValid)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest(ModelState);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> updatedDomainInvoice = updateInvoiceMapper.ToDomain(updateInvoice, id);</div><div class="line">    invoiceRepository.Update(updatedDomainInvoice);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> NoContent();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In the method our input is now JsonPatchDocument<updateinvoice> meaning it is an UpdateInvoice model we perform the operations on. Again we start out with a validation if the input is malformed. Next we handle the case where the invoice is not found. Since we perform the operations against an instance of UpdateInvoice here, then we must construct that instance first from the domain model. So ToModel transforms the loaded entity to our model representation. Then the patch operations are applied using patchDocument.ApplyTo. We also pass in the ModelState so that the validation will still kick in. After ApplyTo we check the ModelState. Last step it to update the invoice using the repository.</updateinvoice></p>
<h2 id="HTTP-Options"><a href="#HTTP-Options" class="headerlink" title="HTTP Options"></a>HTTP Options</h2><p>To provide a more complete REST Api we can choose to implement the HTTP OPTIONS verb.</p>
<blockquote>
<p>The OPTIONS method represents a request for information about the communication options available on the request/response chain identified by the Request-URI. This method allows the client to determine the options and/or requirements associated with a resource, or the capabilities of a server, without implying a resource action or initiating a resource retrieval. </p>
</blockquote>
<p>Using it we can determine which other Http Verbs that are available at a given uri. We can use this to eg. remove Http Put/Patch methods when no instance exists. The methods that are available should be specified in the <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.7" target="_blank" rel="external">allow header</a></p>
<p>Allow: GET, POST, PUT</p>
<p>So let’s add the first OPTIONS method for the /invoices uri</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[HttpOptions]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Options</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    Response.Headers.Add(<span class="string">"Allow"</span>, <span class="keyword">string</span>.Join(<span class="string">","</span>, HttpVerbs.Options, HttpVerbs.Post));</div><div class="line">    <span class="keyword">return</span> NoContent();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now when we make a OPTIONS request we get</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 204 No Content</div><div class="line">Date: Mon, 12 Dec 2016 10:22:07 GMT</div><div class="line">Allow: OPTIONS,POST</div></pre></td></tr></table></figure>
<p>basically saying all we can do is create a new invoice.</p>
<p>When we call HTTP OPTIONS on an invoice we should return OPTIONS,GET,PUT,PATCH if the invoice exists. If not then “OPTIONS, GET”. I include GET since it can return a 404 as the response.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[HttpOptions(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">OptionsForInvoice</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (!invoiceRepository.Exists(id))</div><div class="line">    &#123;</div><div class="line">        Response.Headers.Add(<span class="string">"Allow"</span>, <span class="keyword">string</span>.Join(<span class="string">","</span>,</div><div class="line">            HttpVerbs.Options,</div><div class="line">            HttpVerbs.Get));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        Response.Headers.Add(<span class="string">"Allow"</span>, <span class="keyword">string</span>.Join(<span class="string">","</span>,</div><div class="line">            HttpVerbs.Options,</div><div class="line">            HttpVerbs.Get,</div><div class="line">            HttpVerbs.Put,</div><div class="line">            HttpVerbs.Patch));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> NoContent();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap up"></a>Wrap up</h2><p>That’s it for this time, but we are still not there so other posts will follow.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" data-id="ciwvz30du00052saawo4nvrm9" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Building-a-basic-REST-aspnet-core-example" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" class="article-date">
  <time datetime="2016-12-08T18:48:17.000Z" itemprop="datePublished">Dec 8 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/">Building a basic REST AspNet Core Example - Part 1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In this post we will start on an app that exposes a REST web api for an invoice. Disclaimer - It is going to be pretty naive and basic, but I will add to it in further posts (hopefully). So actually we will for now go no higher in <a href="http://martinfowler.com/articles/richardsonMaturityModel.html" target="_blank" rel="external">richardson’s maturity model</a> than level 2. </p>
<p>My inspiration for this blog is attending <a href="http://www.skillsmatter.co.uk" target="_blank" rel="external">skillsmatters</a> “Fast-Track to RESTful Microservices” course with Jim Webber. It is highly based on the book <a href="https://www.amazon.com/REST-Practice-Hypermedia-Systems-Architecture/dp/0596805829/ref=sr_1_1?ie=UTF8&amp;qid=1481025806&amp;sr=8-1&amp;keywords=rest+in+practice" target="_blank" rel="external">REST in Practice: Hypermedia and Systems Architecture</a>. Although the book is now old it still contains good information (code examples are naturally outdated) - so read it if you need extensive REST information, but can live with not all is up to date.</p>
<p>The case here is creating, updating and getting an invoice along the lines of these user stories. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">As a &lt;business user&gt; </div><div class="line">I want &lt;to be able to create an invoice for a customer&gt;</div><div class="line">So that &lt;we can facilitate sales&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">As a &lt;business user&gt; </div><div class="line">I want &lt;to be able to update an invoice&gt;</div><div class="line">So that &lt;it can be created in steps&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">As a &lt;business user&gt; </div><div class="line">I want &lt;to be able to view the invoice&gt;</div><div class="line">So that &lt;I can answer questions related to it&gt;</div></pre></td></tr></table></figure>
<p>Getting a list of invoices, searching etc is too advanced for now.</p>
<p>The server code will be .NET core aspnet web api (and for the fun I’m developing on ubuntu with Jetbrains Rider). It will be without a real database backing it for now - since the focus is mostly on the REST part. It does take a pretty naive approach on design of the API, but hopefully I will get to a post where this part is evolved.</p>
<p>You can find the code discussed at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/1_Invoice_Api" target="_blank" rel="external">github</a> in the 1_InvoiceApi folder.</p>
<h2 id="The-Domain"><a href="#The-Domain" class="headerlink" title="The Domain"></a>The Domain</h2><p>We will call our bounded context finance, and the primary class will be the invoice. We will start with this naive definition</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">Finance.Domain.Domain</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">Invoice</span></div><div class="line">    &#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Invoice</span>(<span class="params"><span class="keyword">string</span> id, DateTimeOffset invoiceDate,</span></span></div><div class="line">            DateTimeOffset dueDate,</div><div class="line">            InvoiceCustomer invoiceCustomer,</div><div class="line">            IEnumerable&lt;InvoiceLine&gt; lines)</div><div class="line">        &#123;</div><div class="line">            InvoiceDate = invoiceDate;</div><div class="line">            DueDate = dueDate;</div><div class="line">            Customer = invoiceCustomer;</div><div class="line">            Lines = lines;</div><div class="line">            Id = id;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">        <span class="keyword">public</span> DateTimeOffset InvoiceDate &#123; <span class="keyword">get</span>; &#125;</div><div class="line">        <span class="keyword">public</span> DateTimeOffset DueDate &#123; <span class="keyword">get</span>; &#125;</div><div class="line">        <span class="keyword">public</span> InvoiceCustomer Customer &#123; <span class="keyword">get</span>; &#125;</div><div class="line">        <span class="keyword">public</span> IEnumerable&lt;InvoiceLine&gt; Lines &#123; <span class="keyword">get</span>; &#125;</div><div class="line">		<span class="keyword">public</span> Amount SubTotal =&gt; <span class="keyword">new</span> Amount(Lines.Sum(l =&gt; l.Total.Value));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The customer and lines are not important for understanding at present time.</p>
<h2 id="The-repository"><a href="#The-repository" class="headerlink" title="The repository"></a>The repository</h2><p>The invoice is accompanied with an InvoiceReposity class implementing IRepository&lt;Invoice&gt; that looks like this</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public interface IRepository&lt;T&gt;</div><div class="line">&#123;</div><div class="line">    T Get(string id);</div><div class="line">    void Update(T instance);</div><div class="line">    T Create(T instance);</div><div class="line">    bool Exists(string id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>for now we have a list of 1000 prepopulated invoices with id 1-1000. The repository is a simple dictionary.</p>
<h2 id="Looking-for-the-API"><a href="#Looking-for-the-API" class="headerlink" title="Looking for the API"></a>Looking for the API</h2><p>We will center the API around what the business does - that is its domain and the mentioned user stories. With Level 1 in the REST maturity level with introduce resource representations. We use urls to differentiate between these resource representations. So in our case it will be an invoice resource representation. Remember the resource representation does not have to match our domain model. It will be designed from what information we wish to conway, and we may have multiple resource representations for the same domain invoice.</p>
<p>So since we are going for a CRU(D) implementation here our invoice API can look like this</p>
<table>
<thead>
<tr>
<th>Http Verb</th>
<th>Uri</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>invoices/{id}</td>
<td>Get invoice representation</td>
</tr>
<tr>
<td>POST</td>
<td>invoices</td>
<td>Create a new invoice</td>
</tr>
<tr>
<td>PUT</td>
<td>invoices/{id}</td>
<td>Update an existing invoice</td>
</tr>
</tbody>
</table>
<p>Actually we are already getting a good start on Level 2 Http in the maturity model. We are using the <a href="https://www.w3.org/Protocols/rfc2616/rfc2616.html" target="_blank" rel="external">Http protocol</a> verbs, and we must make sure to use status codes correctly, content types and all the other good stuff (safe verbs and idempotency). Now you could ask where the GET invoice/ is. For now it is not there - remember we had 1000 invoices prepopulated - it will need a little more design.</p>
<h3 id="Deciding-on-a-media-type"><a href="#Deciding-on-a-media-type" class="headerlink" title="Deciding on a media type"></a>Deciding on a media type</h3><p>We need to chose a <a href="https://en.wikipedia.org/wiki/Media_type" target="_blank" rel="external">media type</a> for the http calls. Since json is “in” at the moment we could choose application/json. However we would like to have something less general purpose to be able to tell the client about the expected processing model (like introduce hypermedia later). So we create a media type in the vendor tree</p>
<p>application/vnd.restexample.finance+json</p>
<p>assuming we as the owner are called “restexample”. We also added the application name “finance”, but should probably not break it further down, since it will put demands on the client if we have multiple media types. The suffix +json now tells what the underlying representation is.</p>
<p>So in order for us to return any information the client must specify the http header</p>
<p>Accept: application/vnd.restexample.finance+json</p>
<p>or any variant such as */*, application/*.</p>
<p>To enforce the media type we add the following to the Startup class. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></div><div class="line">&#123;</div><div class="line">    services.AddMvc(LimitFormattersToThisApplication);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LimitFormattersToThisApplication</span>(<span class="params">MvcOptions options</span>)</span></div><div class="line">&#123;</div><div class="line">    options.RespectBrowserAcceptHeader = <span class="literal">true</span>;</div><div class="line">    options.ReturnHttpNotAcceptable = <span class="literal">true</span>;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> customMediaType = <span class="keyword">new</span> MediaTypeHeaderValue(ApiDefinition.ApiMediaType);</div><div class="line"></div><div class="line">    options.SetInputMediaType(customMediaType);</div><div class="line">    options.SetOutputMediaType(customMediaType);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">MvcOptionsExtensions</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetInputMediaType</span>(<span class="params"><span class="keyword">this</span> MvcOptions options, MediaTypeHeaderValue mediaType</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> supportedInputMediaTypes = options</div><div class="line">            .InputFormatters</div><div class="line">            .OfType&lt;JsonInputFormatter&gt;()</div><div class="line">            .First()</div><div class="line">            .SupportedMediaTypes;</div><div class="line"></div><div class="line">        SetAllowedMediaType(mediaType, supportedInputMediaTypes);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetOutputMediaType</span>(<span class="params"><span class="keyword">this</span> MvcOptions options, MediaTypeHeaderValue mediaType</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> supportedOutputMediaTypes = options</div><div class="line">            .OutputFormatters</div><div class="line">            .OfType&lt;JsonOutputFormatter&gt;()</div><div class="line">            .First()</div><div class="line">            .SupportedMediaTypes;</div><div class="line"></div><div class="line">        SetAllowedMediaType(mediaType, supportedOutputMediaTypes);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetAllowedMediaType</span>(<span class="params">MediaTypeHeaderValue mediaType,</span></span></div><div class="line">        MediaTypeCollection supportedInputMediaTypes)</div><div class="line">    &#123;</div><div class="line">        supportedInputMediaTypes.Clear();</div><div class="line">        supportedInputMediaTypes.Add(mediaType);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The extension methods sets the output and input media type. Note ReturnHttpNotAcceptable is set to true in order to return </p>
<p>406 Not Acceptable</p>
<p>when the reponse format requested in the accept header does not match our custom media type.</p>
<h3 id="Invoice-resource-representation"><a href="#Invoice-resource-representation" class="headerlink" title="Invoice resource representation"></a>Invoice resource representation</h3><h4 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h4><p>For now we will use this invoice representation for GET that matches the domain representation except for some value object representations in the domain (DDD term)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="attr">"id"</span>: <span class="string">"1000"</span>,</div><div class="line">	<span class="attr">"invoiceDate"</span>: <span class="string">"2016-12-05T00:00Z"</span>,</div><div class="line">	<span class="attr">"dueDate"</span>: <span class="string">"2016-12-12T00:00Z"</span>,</div><div class="line">	<span class="attr">"subTotal"</span>: <span class="number">9050</span>,</div><div class="line">	<span class="attr">"customer"</span>: &#123;</div><div class="line">		<span class="attr">"name"</span>: <span class="string">"Microsoft Development Center"</span>,</div><div class="line">		<span class="attr">"addressLines"</span>: [<span class="string">"Kanalvej 8"</span>, <span class="string">"2800 Kongens Lyngby"</span>]</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">"lines"</span>: [</div><div class="line">		&#123; </div><div class="line">			<span class="attr">"lineNumber"</span>: <span class="number">1</span>, </div><div class="line">			<span class="attr">"description"</span>: <span class="string">"consultancy"</span>, </div><div class="line">			<span class="attr">"quantity"</span>: <span class="number">10</span>, </div><div class="line">			<span class="attr">"itemPrice"</span>: <span class="number">905</span>, </div><div class="line">			<span class="attr">"total"</span>: <span class="number">9050</span> </div><div class="line">		&#125;</div><div class="line">	]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>That raises the question of what happens to “total” values on POST or PUT. The answer is we need a different representation without these fields. </p>
<h4 id="PUT-POST"><a href="#PUT-POST" class="headerlink" title="PUT/POST"></a>PUT/POST</h4><p>Besides removing the total values in the resource representation we also remove the id, ie. we will not let it be up to the client to set it (could be a valid option).</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="attr">"invoiceDate"</span>: <span class="string">"2016-12-05T00:00Z"</span>,</div><div class="line">	<span class="attr">"dueDate"</span>: <span class="string">"2016-12-12T00:00Z"</span>,</div><div class="line">	<span class="attr">"customer"</span>: &#123;</div><div class="line">		<span class="attr">"name"</span>: <span class="string">"Microsoft Development Center"</span>,</div><div class="line">		<span class="attr">"addressLines"</span>: [<span class="string">"Kanalvej 8"</span>, <span class="string">"2800 Kongens Lyngby"</span>]</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">"lines"</span>: [</div><div class="line">		&#123; </div><div class="line">			<span class="attr">"lineNumber"</span>: <span class="number">1</span>, </div><div class="line">			<span class="attr">"description"</span>: <span class="string">"consultancy"</span>, </div><div class="line">			<span class="attr">"quantity"</span>: <span class="number">10</span>, </div><div class="line">			<span class="attr">"itemPrice"</span>: <span class="number">905</span></div><div class="line">		&#125;</div><div class="line">	]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="The-Invoice-controller"><a href="#The-Invoice-controller" class="headerlink" title="The Invoice controller"></a>The Invoice controller</h3><p>For now we are not going all in on DDD with a separate application service layer, but rather survive with that code in the controller.</p>
<h4 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h4><p>So here is the GET implementation</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[Route(<span class="string">"invoice"</span>)]</div><div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">InvoicesController</span> : <span class="title">Controller</span></div><div class="line">&#123;</div><div class="line">...</div><div class="line">    [HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetInvoice"</span>)]</div><div class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> invoice = invoiceRepository.Get(id);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (invoice == <span class="literal">null</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> NotFound();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> Ok(mapper.ToModel(invoice));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>We use a literal in the Route attribute to avoid issues with refactoring. If we cannot find the invoice then we return a 404 Not found. Else we return the invoice. It is mapped to this GET model. Notice the HttpGet specifies a Name. This is used in the Post action later.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">GetInvoice</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> DateTimeOffset InvoiceDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> DateTimeOffset DueDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> GetInvoiceCustomer Customer &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">decimal</span> SubTotal &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> IEnumerable&lt;GetInvoiceLine&gt; Lines &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>I am sure GetInvoice will cause some discussion for now. You could do without different representations for the Http verb’s, but then that would impact on the validation etc. That is the reason behind the choice here as you will see in a moment on POST.</p>
<h4 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h4><p>In post we have more to take into account. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[HttpPost]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Post</span>(<span class="params">[FromBody] UpdateInvoice updateInvoice</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (updateInvoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!ModelState.IsValid)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest(ModelState);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> createdInvoice = invoiceRepository.Create(updateInvoiceMapper.ToDomain(updateInvoice));</div><div class="line"></div><div class="line">    <span class="keyword">return</span> CreatedAtRoute(<span class="string">"GetInvoice"</span>,</div><div class="line">        <span class="keyword">new</span> &#123; id = createdInvoice.Id &#125;,</div><div class="line">        getInvoiceMapper.ToModel(createdInvoice));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>First of all the request could be malformed in such a way that updateInvoice is null. We will return BadRequest then.</p>
<p>Next is to check if the model is valid. This is one of the reasons for having UpdateInvoice, UpdateInvoiceLine, UpdateInvoiceCustomer models where we decorate with data annotations like shown here</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">UpdateInvoice</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> DateTimeOffset InvoiceDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> DateTimeOffset DueDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> UpdateInvoiceCustomer Customer &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> IEnumerable&lt;UpdateInvoiceLine&gt; Lines &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">UpdateInvoiceLine</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> LineNumber &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">decimal</span> Quantity &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">decimal</span> ItemPrice &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line"></div><div class="line">    [Required(ErrorMessage = <span class="string">"Invoice line description must be specified"</span>)]</div><div class="line">    [MaxLength(<span class="number">500</span>, ErrorMessage = <span class="string">"Invoice line description is too long"</span>)]</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Description &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If everything goes well we will return the newly created invoice with a 201 and a Location header for the new resource like shown here</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 201 Created</div><div class="line">Date: Thu, 08 Dec 2016 12:40:35 GMT</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Content-Type: application/vnd.restexample.finance+json; charset=utf-8</div><div class="line">Location: http://localhost:5000/invoice/1002</div><div class="line"></div><div class="line">&#123;</div><div class="line">	&quot;invoiceDate&quot;:&quot;2016-12-05T00:00:00+00:00&quot;,</div><div class="line">	&quot;dueDate&quot;:&quot;2016-12-12T00:00:00+00:00&quot;,</div><div class="line">	&quot;customer&quot;:&#123;</div><div class="line">		&quot;name&quot;:&quot;Microsoft Development Center&quot;,</div><div class="line">		&quot;addressLines&quot;:[&quot;Kanalvej 8&quot;,&quot;2800 Kongens Lyngby&quot;]</div><div class="line">		&#125;,</div><div class="line">	&quot;subTotal&quot;:0.0,</div><div class="line">	&quot;lines&quot;:[</div><div class="line">		&#123;&quot;lineNumber&quot;:1,&quot;description&quot;:&quot;test&quot;,&quot;quantity&quot;:10.0,&quot;itemPrice&quot;:1.0,&quot;total&quot;:10.0&#125;</div><div class="line">	],</div><div class="line">	&quot;id&quot;:&quot;1002&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Note that when calling POST we have to add the headers</p>
<p>Accept: application/vnd.restexample.finance+json<br>Content-Type: application/vnd.restexample.finance+json</p>
<p>However the code here in the POST is not pretty when it comes to DRY, but that will be a topic for a later blog.</p>
<h4 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h4><p>With Put we wish to update the invoice. We must supply the full payload for updating. We will in a later blog look at the Patch verb.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[HttpPut(<span class="string">"&#123;id&#125;"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Put</span>(<span class="params"><span class="keyword">string</span> id, [FromBody] UpdateInvoice updateInvoice</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (updateInvoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!ModelState.IsValid)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> BadRequest(ModelState);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!invoiceRepository.Exists(id))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    invoiceRepository.Update(updateInvoiceMapper.ToDomain(updateInvoice, id));</div><div class="line"></div><div class="line">    <span class="keyword">return</span> NoContent();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The two first validations are simular to Post. Then we check if the invoice exists and return NotFound if not. If we can update then we return NoContent (the client has the invoice already).</p>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h2><p>That is it for the most basic api for now. But we can do much more as we will see in later posts (hopefully).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/08/Building-a-basic-REST-aspnet-core-example/" data-id="ciwvz30dx00082saap841wfww" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/08/Building-a-basic-REST-aspnet-core-example/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET-Core/">.NET Core</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure/">Azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REST/">REST</a><span class="tag-list-count">8</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET-Core/" style="font-size: 20px;">.NET Core</a> <a href="/tags/AspNet-Mvc/" style="font-size: 20px;">AspNet Mvc</a> <a href="/tags/Azure/" style="font-size: 10px;">Azure</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/REST/" style="font-size: 20px;">REST</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/">Building a basic REST AspNet Core Example: Hypermedia - Part 8</a>
          </li>
        
          <li>
            <a href="/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/">Building a basic REST AspNet Core Example: Caching - Part 7</a>
          </li>
        
          <li>
            <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/">Building a basic REST AspNet Core Example - Part 6</a>
          </li>
        
          <li>
            <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/">Building a basic REST AspNet Core Example - Part 5</a>
          </li>
        
          <li>
            <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/">Building a basic REST AspNet Core Example - Part 4</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Mikael Kühn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'codeplayground';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>