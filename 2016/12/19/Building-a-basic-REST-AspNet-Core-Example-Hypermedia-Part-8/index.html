<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Building a basic REST AspNet Core Example: Hypermedia - Part 8 | Code Playground</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="If you need to catch up on the previous posts then see part 1 &amp;amp; 2, 3, 4, 5, 6, 7. The source code for this post is at github.
First a disclaimer - this blog is a journey for me, I am no expert in">
<meta property="og:type" content="article">
<meta property="og:title" content="Building a basic REST AspNet Core Example: Hypermedia - Part 8">
<meta property="og:url" content="http://blog.codeplayground.org/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/index.html">
<meta property="og:site_name" content="Code Playground">
<meta property="og:description" content="If you need to catch up on the previous posts then see part 1 &amp;amp; 2, 3, 4, 5, 6, 7. The source code for this post is at github.
First a disclaimer - this blog is a journey for me, I am no expert in">
<meta property="og:updated_time" content="2016-12-21T17:15:40.278Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Building a basic REST AspNet Core Example: Hypermedia - Part 8">
<meta name="twitter:description" content="If you need to catch up on the previous posts then see part 1 &amp;amp; 2, 3, 4, 5, 6, 7. The source code for this post is at github.
First a disclaimer - this blog is a journey for me, I am no expert in">
  
    <link rel="alternative" href="/atom.xml" title="Code Playground" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-89020543-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Code Playground</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Learning something daily</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/" class="article-date">
  <time datetime="2016-12-19T11:01:53.000Z" itemprop="datePublished">Dec 19 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Building a basic REST AspNet Core Example: Hypermedia - Part 8
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you need to catch up on the previous posts then see <a href="/2016/12/08/Building-a-basic-REST-aspnet-core-example/" title="part 1">part 1</a> &amp; <a href="/2016/12/09/Building-a-basic-REST-aspnet-core-example-Part-2/" title="2">2</a>, <a href="/2016/12/12/Building-a-basic-REST-aspnet-core-example-Part-3/" title="3">3</a>, <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/" title="4">4</a>, <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/" title="5">5</a>, <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/" title="6">6</a>, <a href="/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/" title="7">7</a>. The source code for this post is at <a href="https://github.com/mikael-kuhn/basic-rest/tree/master/8_Invoice_Api" target="_blank" rel="external">github</a>.</p>
<p>First a disclaimer - this blog is a journey for me, I am no expert in hypermedia - rather a newbie trying it and documenting it here (hence the site name Code Playground). So whether or not I am all into hypermedia is to be determined.</p>
<h2 id="Hypermedia"><a href="#Hypermedia" class="headerlink" title="Hypermedia"></a>Hypermedia</h2><p>The third level of <a href="http://martinfowler.com/articles/richardsonMaturityModel.html" target="_blank" rel="external">Richardson’s maturity model</a> is about hypermedia. Oversimplified it is about also providing links in the response to actions you can take from the given state. HTML has hypermedia controls for this like the form, a, img tags. No-one really needs a manuel or documentation to use a web-site, and hypermedia can be seen as a way to make a protocol more self-documenting, make it less brittle to version changes etc.(if you provide all URI’s to the api then you can be locked in when attempting to change).</p>
<p>Notice Roy Fielding the man who coined REST is pretty strict on hypermedia saying you cannot call it REST without it. <a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven" target="_blank" rel="external">Read this post for more on that statement</a>. So no doubt the REST term is misused by many API’s in the wild.</p>
<p>With Json it is more unclear how hypermedia controls should be provided.  There is a range of options like</p>
<ul>
<li><a href="http://json-ld.org/" target="_blank" rel="external">Json-LD</a> (or look <a href="https://www.w3.org/TR/json-ld/" target="_blank" rel="external">here</a>)</li>
<li><a href="https://tools.ietf.org/html/draft-kelly-json-hal-08" target="_blank" rel="external">HAL</a> (notice the status is draft and V8 has just expired)</li>
<li><a href="http://jsonapi.org/" target="_blank" rel="external">JSON API</a></li>
<li><a href="http://amundsen.com/media-types/collection/" target="_blank" rel="external">Collection+Json</a></li>
<li><a href="https://github.com/kevinswiber/siren/blob/master/README.md" target="_blank" rel="external">Siren</a></li>
</ul>
<p>The “RESTFul Web APIs: Services for a Changing World” <a href="https://www.amazon.com/RESTful-Web-APIs-Services-Changing-ebook/dp/B00F5BS966" target="_blank" rel="external">book</a> looks at many of these and may be a read worth. You can also read this <a href="https://sookocheff.com/post/api/on-choosing-a-hypermedia-format/" target="_blank" rel="external">post by Kevin Sookocheff</a> that covers these formats. There is more material to this subject than I can cover - and I do not claim to be that familiar with each of the standards. In this post I will look at the first two.</p>
<h2 id="Json-LD-A-JSON-based-Serialization-for-Linked-Data"><a href="#Json-LD-A-JSON-based-Serialization-for-Linked-Data" class="headerlink" title="Json-LD - A JSON-based Serialization for Linked Data"></a>Json-LD - A JSON-based Serialization for Linked Data</h2><p>This is a W3C recommendation. It builds on the concept of Linked Data that says 1) Use URIs as names for things, 2) use HTTP URIs so that people can lookup the names 3) when someone looks up a URI provide useful information &amp; 4) include links to other URIs, so that people can discover more things.</p>
<p>You may read the Json-LD introduction to understand it further, but basically it provides eg. the ability to use links in your json and to describe the json document and its terms itself. It can be used on an existing API if you wish. There is a nice video <a href="https://www.youtube.com/watch?v=vioCbTo3C-4" target="_blank" rel="external">here</a> explaining the basics, and <a href="https://www.youtube.com/watch?v=UmvWk_TQ30A" target="_blank" rel="external">another one</a> that continues on the first. Expansion and Compaction is <a href="https://www.youtube.com/watch?v=Tm3fD89dqRE" target="_blank" rel="external">explained here</a> and is useful to watch to get the data exchange idea behind Json-LD.</p>
<p>Let’s look at how Json-LD can be used with our invoice representation. But first let’s look at the response for GET /invoices/1,</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  &quot;dueDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  &quot;customer&quot;: &#123;</div><div class="line">    &quot;name&quot;: &quot;Customer 1&quot;,</div><div class="line">    &quot;addressLines&quot;: []</div><div class="line">  &#125;,</div><div class="line">  &quot;subTotal&quot;: 20.0,</div><div class="line">  &quot;lines&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;lineNumber&quot;: 1,</div><div class="line">      &quot;description&quot;: &quot;Line 1&quot;,</div><div class="line">      &quot;quantity&quot;: 2.0,</div><div class="line">      &quot;itemPrice&quot;: 10.0,</div><div class="line">      &quot;total&quot;: 20.0</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;id&quot;: &quot;1&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now when using the property name invoiceDate what exactly do we mean. Json-LD aims high and goes for a common understanding between different web sites of what we mean, so it tries to solve the ambiguity of what that term means. To be specific the property could be specified as an URI (or URL if it can be dereferenced)</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;http://restexample.org/types/invoice#invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>in this case it states we mean an invoice date as defined by restexample.  And at the end of this url we provide documentation for this property. We could also have looked in schema.org and picked the URL from there - thus aiming to provide a more crosssite understanding the data, but even within our own company this may be useful. But to fit that understanding into your existing json structure we add a @context to the json. The context tells us how to understand the json data. It allows us to map between the property name (called terms) and the unique name (IRI), as shown here. </p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &#123;</div><div class="line">		&quot;invoiceDate&quot;: &quot;http://restexample.org/types/invoice#invoiceDate&quot;	</div><div class="line">		...</div><div class="line">	&#125;</div><div class="line">  invoiceDate: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The context does not have to go within your data as shown here. It can be pointed to using the Http Link header. You can also reference it like this<br><figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &quot;http://restexample.org/invoice.jsonld&quot;</div><div class="line">  	&quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  	...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>It also introduces the concept of global identifiers to identify the objects, that is to add links.</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &quot;http://restexample.org/invoice.jsonld&quot;</div><div class="line">  	&quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  	&quot;@id&quot;: &quot;http://restexample.org/invoice/1&quot;</div><div class="line">  	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>So eg. in the case of getting a list of invoices this can be useful with a link for each invoice. You can also specify the type of a property. Let’s say our invoice has a link to sales support</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &#123;</div><div class="line">		&quot;invoiceDate&quot;: &quot;http://restexample.org/types/invoice#invoiceDate&quot;,</div><div class="line">		&quot;salesSupport&quot;: &#123;</div><div class="line">			&quot;@id&quot;: &quot;http://restexample.org/types/invoice#salesSupport&quot;,</div><div class="line">			&quot;@type&quot;: &quot;@id&quot;</div><div class="line">		&#125;</div><div class="line">		...</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">  	&quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">  	&quot;salesSupport&quot;: &quot;http://restexample.org/salesSupport&quot;</div><div class="line">  	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>with the above context we can specify the property salesSupport is to be treated like a link. @type can more generally be used to inform about its type like number, datetime etc. Like shown here.</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &#123;</div><div class="line">		&quot;invoiceDate&quot;: &#123;</div><div class="line">				&quot;@id&quot;: &quot;http://restexample.org/types/invoice#invoiceDate&quot;,</div><div class="line">				&quot;@type&quot;: &quot;https://schema.org/DateTime&quot;</div><div class="line">		&#125;,</div><div class="line">		&quot;dueDate&quot;: &#123;</div><div class="line">				&quot;@id&quot;: &quot;http://restexample.org/types/invoice#dueDate&quot;,</div><div class="line">				&quot;@type&quot;: &quot;https://schema.org/DateTime&quot;</div><div class="line">		&#125;,</div><div class="line">		&quot;subTotal&quot;: &#123;</div><div class="line">			&quot;@id&quot;: &quot;http://restexample.org/types/invoice#subTotal&quot;,</div><div class="line">			&quot;@type&quot;: &quot;https://schema.org/Number&quot;</div><div class="line">		&#125;,</div><div class="line">		...</div><div class="line">      &#125;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>There’s much more to Json-Ld than shown here, but these are the basics. You can’t specify the actions you can take given the response. For this you can combine Json-Ld with <a href="http://www.markus-lanthaler.com/hydra/" target="_blank" rel="external">Hydra</a>. There’s a video on hydra <a href="https://www.youtube.com/watch?v=tRTD2W4W8G4" target="_blank" rel="external">here</a>. Hydra calls these actions “operations”. So you could specify that a delete operation exists like this</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;@context&quot;: &quot;http://www.w3.org/ns/hydra/context.jsonld&quot;,</div><div class="line">	&quot;@id&quot;: &quot;http://restexample.org/invoice/1&quot;,</div><div class="line">	&quot;operation&quot;: [</div><div class="line">		&#123;</div><div class="line">			&quot;@type&quot;: &quot;DeleteResourceOperation&quot;,</div><div class="line">			&quot;method&quot;: &quot;DELETE&quot;</div><div class="line">		&#125;</div><div class="line">	],</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>That’s just a simple example - I won’t cover hydra here in detail.</p>
<h3 id="AspNet-Core"><a href="#AspNet-Core" class="headerlink" title="AspNet Core"></a>AspNet Core</h3><p>To be reasonable to add Json-LD to the API some tooling is required. If not then these definitions will just end up out of sync with the implementation. For Json-LD client side operation there is <a href="https://github.com/NuGet/json-ld.net/" target="_blank" rel="external">json-ld.net</a> supporting the <a href="https://www.w3.org/TR/json-ld-api/" target="_blank" rel="external">Json-LD 1.0 Processing Algoritms and API</a>. There is also this <a href="https://github.com/wikibus/JsonLD.Entities" target="_blank" rel="external">one</a> that is not .Net core. So based on a quick google tour there is not something that easily fits the purpose. Let me know if you have the solution.</p>
<h2 id="HAL-JSON-Hypertext-Application-Language"><a href="#HAL-JSON-Hypertext-Application-Language" class="headerlink" title="HAL - JSON Hypertext Application Language"></a>HAL - JSON Hypertext Application Language</h2><p>Taken from HAL’s specification:</p>
<blockquote>
<p>HAL is a generic media type with which Web APIs can be developed and exposed as series of links.  Clients of these APIs can select links by their link relation type and traverse them in order to progress through the application.</p>
</blockquote>
<p>Basically it adds two reserved properties _links and _embedded JSON. It’s media type is “application/hal+json”. _links is defined as</p>
<blockquote>
<p>It is an object whose property names are link relation types (as defined by [RFC5988]) and values are either a Link Object or an array of Link Objects.  The subject resource of these links is the Resource Object of which the containing “_links” object is a property. </p>
</blockquote>
<p>To get the understanding of link relation types you can read <a href="https://tools.ietf.org/html/rfc5988#section-4" target="_blank" rel="external">RFC 5988 section 4</a> that says,</p>
<blockquote>
<p>In the simplest case, a link relation type identifies the semantics of a link.  For example, a link with the relation type “copyright” indicates that the resource identified by the target IRI is a statement of the copyright terms applying to the current context IRI. Link relation types can also be used to indicate that the target resource has particular attributes, or exhibits particular behaviours; for example, a “service” link implies that the identified resource is part of a defined protocol (in this case, a service description). </p>
</blockquote>
<p>So let’s see the link relation type as a a property name in HAL:<br><figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"> ...  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>“self” is the link relation property. <a href="https://tools.ietf.org/html/rfc4287#section-4.2.7.2" target="_blank" rel="external">“self”</a> signifies that the URL in the value of href attribute identifies a resource equivalent to the containing element. IANA has a link relation registry <a href="https://www.iana.org/assignments/link-relations/link-relations.xml" target="_blank" rel="external">here</a>. So take a look at these before inventing your own. </p>
<p>_embedded is defined as</p>
<blockquote>
<p>It is an object whose property names are link relation types (as defined by [RFC5988]) and values are either a Resource Object or an array of Resource Objects. Embedded Resources MAY be a full, partial, or inconsistent version of the representation served from the target URI.</p>
</blockquote>
<p>The Linked object can have the following properties href, templated, type, deprecation, name, profile, title, hreflang. But let’s see a constructed example for GET /invoices/</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;next&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices?page=2&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  &quot;_embedded&quot;: &#123;</div><div class="line">    &quot;invoices&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/2&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;invoiceDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">        &quot;dueDate&quot;: &quot;2016-12-19T00:00:00+01:00&quot;,</div><div class="line">        &quot;customer&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;Customer 1&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;subTotal&quot;: 20.0,</div><div class="line">        &quot;id&quot;: &quot;2&quot;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/2&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;invoiceDate&quot;: &quot;2016-12-18T00:00:00+01:00&quot;,</div><div class="line">        &quot;dueDate&quot;: &quot;2016-12-18T00:00:00+01:00&quot;,</div><div class="line">        &quot;customer&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;Customer 2&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;subTotal&quot;: 130.0,</div><div class="line">        &quot;id&quot;: &quot;1&quot;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here we have a “next” link relation that takes us to be next subset of invoices. _embedded contains a partial representation of the invoice representation with a link to each invoice. </p>
<p>In the above example we are using link relation types registered with IANA. When you need to create your own then <a href="https://tools.ietf.org/html/rfc5988#section-4.2" target="_blank" rel="external">RFC 5988 defines “Extension Relations Types”</a> says</p>
<blockquote>
<p>Applications that don’t wish to register a relation type can use an extension relation type, which is a URI [RFC3986] that uniquely identifies the relation type.  Although the URI can point to a resource that contains a definition of the semantics of the relation type, clients SHOULD NOT automatically access that resource to avoid overburdening its server.</p>
</blockquote>
<p>So <a href="http://restexample.org/relationTypes/foo" target="_blank" rel="external">http://restexample.org/relationTypes/foo</a> could be our own relation type. HAL tells us to provide links - that can be dereferenced in a web browser - that provides documentation. And we can use the CURIE to shorten these links. Here’s an example</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/orders&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;curies&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;name&quot;: &quot;acme&quot;,</div><div class="line">        &quot;href&quot;: &quot;http://docs.acme.com/relations/&#123;rel&#125;&quot;,</div><div class="line">        &quot;templated&quot;: true</div><div class="line">      &#125;</div><div class="line">    ],</div><div class="line">    &quot;acme:widgets&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/widgets&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>so acme:widgets unfolds to <a href="http://docs.acme.com/relations/widgets" target="_blank" rel="external">http://docs.acme.com/relations/widgets</a>.</p>
<h3 id="AspNet-Core-1"><a href="#AspNet-Core-1" class="headerlink" title="AspNet Core"></a>AspNet Core</h3><p>We can find a list of libraries for HAL <a href="https://github.com/mikekelly/hal_specification/wiki/Libraries" target="_blank" rel="external">here</a>. Most seems out of date (at the time of writing this post) so the choice we have is <a href="https://github.com/visualeyes/halcyon" target="_blank" rel="external">Halcyon</a>. Basically it provides us with a way to return HAL without changing our existing model using an extension method on the controller.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> HAL(model, <span class="keyword">new</span> Link[] &#123;</div><div class="line">    <span class="keyword">new</span> Link(<span class="string">"self"</span>, <span class="string">"/api/foo/&#123;id&#125;"</span>),</div><div class="line">    <span class="keyword">new</span> Link(<span class="string">"foo:bar"</span>, <span class="string">"/api/foo/&#123;id&#125;/bar"</span>)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>So let’s try Halcyon out on the InvoiceController. First change is the GET /invoices/{id}</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[HttpGet(<span class="string">"&#123;id&#125;"</span>, Name = <span class="string">"GetInvoice"</span>)]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> invoice = invoiceRepository.Get(id);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (invoice == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> NotFound();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> currentETag = <span class="keyword">new</span> EntityTagHeaderValue(<span class="string">$"\"<span class="subst">&#123;invoice.Version&#125;</span>\""</span>);</div><div class="line">    <span class="keyword">if</span> (IfMatchGivenIfNoneMatch(currentETag))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> StatusCode((<span class="keyword">int</span>)HttpStatusCode.NotModified);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> responseHeaders = Response.GetTypedHeaders();</div><div class="line">    responseHeaders.ETag = currentETag;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.HAL(getInvoiceMapper.ToModel(invoice),</div><div class="line">        <span class="keyword">new</span> Link(<span class="string">"self"</span>, Request.Path));</div><div class="line">&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>the HAL extension is supplied with our model, and the self link (it will add it by itself if not specified, but with a non-standard method property).</p>
<p>The response for /invoices/1 now looks like this:</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;InvoiceDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">  &quot;DueDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">  &quot;Customer&quot;: &#123;</div><div class="line">    &quot;Name&quot;: &quot;Customer 1&quot;,</div><div class="line">    &quot;AddressLines&quot;: []</div><div class="line">  &#125;,</div><div class="line">  &quot;SubTotal&quot;: 20.0,</div><div class="line">  &quot;Lines&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;LineNumber&quot;: 1,</div><div class="line">      &quot;Description&quot;: &quot;Line 1&quot;,</div><div class="line">      &quot;Quantity&quot;: 2.0,</div><div class="line">      &quot;ItemPrice&quot;: 10.0,</div><div class="line">      &quot;Total&quot;: 20.0</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;Id&quot;: &quot;1&quot;,</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices/1&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>so a _links section is added with a self reference. Next change is the GET /invoices/. Here we use the embedded extension method.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[HttpGet]</div><div class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Get</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> preferHeader = Request.Headers.Prefer();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (SupportedRepresentations.Contains(preferHeader.Return))</div><div class="line">    &#123;</div><div class="line">        Response.Headers.Add(<span class="string">"Preference-Applied"</span>, <span class="string">"return="</span> + preferHeader.Return);</div><div class="line">        Response.Headers.Add(<span class="string">"Vary"</span>, VaryHeaderValue);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> invoices = invoiceRepository.GetAll();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (preferHeader.Return == ReturnMinimal)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.HAL&lt;<span class="keyword">object</span>, GetMinimalInvoice&gt;(<span class="literal">null</span>,</div><div class="line">            <span class="keyword">new</span> Link(<span class="string">"self"</span>, Request.Path),</div><div class="line">            <span class="string">"invoices"</span>,</div><div class="line">            invoices.Select(invoice =&gt; getMinimalInvoiceMapper.ToModel(invoice)),</div><div class="line">            <span class="keyword">new</span> Link(<span class="string">"self"</span>, <span class="string">"/invoices/&#123;Id&#125;"</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.HAL&lt;<span class="keyword">object</span>, GetInvoice&gt;(<span class="literal">null</span>,</div><div class="line">        <span class="keyword">new</span> Link(<span class="string">"self"</span>, Request.Path),</div><div class="line">        <span class="string">"invoices"</span>,</div><div class="line">        invoices.Select(invoice =&gt; getInvoiceMapper.ToModel(invoice)),</div><div class="line">        <span class="keyword">new</span> Link(<span class="string">"self"</span>, <span class="string">"/invoices/&#123;Id&#125;"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we don’t really have any specific data for the collection itself - which is the reason for using null for the model as the first parameter for the HAL method. Then comes the collection link followed by the name of the embedded collection. Next is the embedded collection with its link. The link is specified as a template, that takes the Id from the invoice. Here is the GET</p>
<figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot;: &#123;</div><div class="line">    &quot;self&quot;: &#123;</div><div class="line">      &quot;href&quot;: &quot;/invoices/&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  &quot;_embedded&quot;: &#123;</div><div class="line">    &quot;invoices&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;InvoiceDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;DueDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;Customer&quot;: &#123;</div><div class="line">          &quot;Name&quot;: &quot;Customer 1&quot;,</div><div class="line">          &quot;AddressLines&quot;: []</div><div class="line">        &#125;,</div><div class="line">        &quot;SubTotal&quot;: 20.0,</div><div class="line">        &quot;Lines&quot;: [</div><div class="line">          &#123;</div><div class="line">            &quot;LineNumber&quot;: 1,</div><div class="line">            &quot;Description&quot;: &quot;Line 1&quot;,</div><div class="line">            &quot;Quantity&quot;: 2.0,</div><div class="line">            &quot;ItemPrice&quot;: 10.0,</div><div class="line">            &quot;Total&quot;: 20.0</div><div class="line">          &#125;</div><div class="line">        ],</div><div class="line">        &quot;Id&quot;: &quot;1&quot;,</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/1&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        &quot;InvoiceDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;DueDate&quot;: &quot;2016-12-21T00:00:00+01:00&quot;,</div><div class="line">        &quot;Customer&quot;: &#123;</div><div class="line">          &quot;Name&quot;: &quot;Customer 2&quot;,</div><div class="line">          &quot;AddressLines&quot;: []</div><div class="line">        &#125;,</div><div class="line">        &quot;SubTotal&quot;: 20.0,</div><div class="line">        &quot;Lines&quot;: [</div><div class="line">          &#123;</div><div class="line">            &quot;LineNumber&quot;: 1,</div><div class="line">            &quot;Description&quot;: &quot;Line 1&quot;,</div><div class="line">            &quot;Quantity&quot;: 2.0,</div><div class="line">            &quot;ItemPrice&quot;: 10.0,</div><div class="line">            &quot;Total&quot;: 20.0</div><div class="line">          &#125;</div><div class="line">        ],</div><div class="line">        &quot;Id&quot;: &quot;2&quot;,</div><div class="line">        &quot;_links&quot;: &#123;</div><div class="line">          &quot;self&quot;: &#123;</div><div class="line">            &quot;href&quot;: &quot;/invoices/2&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Providing paging would now be a question of providing a “prev”, “next” link.</p>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap-up"></a>Wrap-up</h2><p>Writing this post I realized that for a newbie to use hypermedia you have a rather large evaluation task to go though.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.codeplayground.org/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/" data-id="ciwvz30ds00042saakts0ejhr" class="article-share-link">Share</a>
      
        <a href="http://blog.codeplayground.org/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET-Core/">.NET Core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST/">REST</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Building a basic REST AspNet Core Example: Caching - Part 7</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET-Core/">.NET Core</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AspNet-Mvc/">AspNet Mvc</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure/">Azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REST/">REST</a><span class="tag-list-count">8</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET-Core/" style="font-size: 20px;">.NET Core</a> <a href="/tags/AspNet-Mvc/" style="font-size: 20px;">AspNet Mvc</a> <a href="/tags/Azure/" style="font-size: 10px;">Azure</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/REST/" style="font-size: 20px;">REST</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/">Building a basic REST AspNet Core Example: Hypermedia - Part 8</a>
          </li>
        
          <li>
            <a href="/2016/12/16/Building-a-basic-REST-AspNet-Core-Example-Caching-Part-7/">Building a basic REST AspNet Core Example: Caching - Part 7</a>
          </li>
        
          <li>
            <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-6/">Building a basic REST AspNet Core Example - Part 6</a>
          </li>
        
          <li>
            <a href="/2016/12/15/Building-a-basic-REST-AspNet-Core-Example-Part-5/">Building a basic REST AspNet Core Example - Part 5</a>
          </li>
        
          <li>
            <a href="/2016/12/14/Building-a-basic-REST-AspNet-Core-Example-Part-4/">Building a basic REST AspNet Core Example - Part 4</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Mikael Kühn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'codeplayground';
  
  var disqus_url = 'http://blog.codeplayground.org/2016/12/19/Building-a-basic-REST-AspNet-Core-Example-Hypermedia-Part-8/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>